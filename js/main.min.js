function playground(t){return new PLAYGROUND.Application(t)}!function(){var t=function(e,i){return"function"==typeof t.cache[i]?t.cache[i](e):t.spline(e,i||t.defaultEasing)},e=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]};e(t,{defaultEasing:"016",cache:{linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t},inSine:function(t){return-1*Math.cos(t/1*(.5*Math.PI))+1},outSine:function(t){return Math.sin(t/1*(.5*Math.PI))},inOutSine:function(t){return-0.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0==t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1==t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-1*(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1-(t-=1)*t)},inOutCirc:function(t){return(t/=.5)<1?-0.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(1==t)return 1;if(i||(i=.3),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i))},outElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(1==t)return 1;if(i||(i=.3),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/i)+1},inOutElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(2==(t/=.5))return 1;if(i||(i=.3*1.5),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return 1>t?-.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)):n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1},inBack:function(t,e){return void 0==e&&(e=1.70158),1*t*t*((e+1)*t-e)},outBack:function(t,e){return void 0==e&&(e=1.70158),1*((t=t/1-1)*t*((e+1)*t+e)+1)},inOutBack:function(t,e){return void 0==e&&(e=1.70158),(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},inBounce:function(t){return 1-this.outBounce(1-t)},outBounce:function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*this.inBounce(2*t):.5*this.outBounce(2*t-1)+.5}},translateEasing:function(t){if(!this.cache[t]){for(var e=t.split(""),i=1,n=!1,s=!1,a=0;a<e.length;a++){var o=e[a];"-"===o?(i=-1,n=!0,e.splice(a--,1)):"+"===o?(i=1,e.splice(a--,1)):"t"===o?(s=!s,e.splice(a--,1)):e[a]=parseInt(e[a],16)*i}for(var r=Math.min.apply(null,e),h=Math.max.apply(null,e),c=h-r,u=[],a=0;a<e.length;a++){if(n)var c=Math.max(Math.abs(r),Math.abs(h)),l=e[a]/c;else var c=h-r,l=(e[a]-r)/c;s&&(0>l&&(l=0),l>1&&(l=1)),u.push(l)}this.cache[t]=u}return this.cache[t]},splineK:{},splineX:{},splineY:{},insertIntermediateValues:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]),i<t.length-1&&e.push(t[i+1]+.6*(t[i]-t[i+1]));return e},spline:function(t,e){if(!this.splineK[e]){var i=[],n=this.translateEasing(e);if(!n.length)return 0;for(var s=0;s<n.length;s++)i.push(s*(1/(n.length-1)));var a=i.map(function(){return 0});a=this.getNaturalKs(i,n,a),this.splineX[e]=i,this.splineY[e]=n,this.splineK[e]=a}if(t>1)return this.splineY[e][this.splineY[e].length-1];for(var a=this.splineK[e],i=this.splineX[e],n=this.splineY[e],s=1;i[s]<t;)s++;var o=(t-i[s-1])/(i[s]-i[s-1]),r=a[s-1]*(i[s]-i[s-1])-(n[s]-n[s-1]),h=-a[s]*(i[s]-i[s-1])+(n[s]-n[s-1]),c=(1-o)*n[s-1]+o*n[s]+o*(1-o)*(r*(1-o)+h*o);return c},getNaturalKs:function(t,e,i){for(var n=t.length-1,s=this.zerosMat(n+1,n+2),a=1;n>a;a++)s[a][a-1]=1/(t[a]-t[a-1]),s[a][a]=2*(1/(t[a]-t[a-1])+1/(t[a+1]-t[a])),s[a][a+1]=1/(t[a+1]-t[a]),s[a][n+1]=3*((e[a]-e[a-1])/((t[a]-t[a-1])*(t[a]-t[a-1]))+(e[a+1]-e[a])/((t[a+1]-t[a])*(t[a+1]-t[a])));return s[0][0]=2/(t[1]-t[0]),s[0][1]=1/(t[1]-t[0]),s[0][n+1]=3*(e[1]-e[0])/((t[1]-t[0])*(t[1]-t[0])),s[n][n-1]=1/(t[n]-t[n-1]),s[n][n]=2/(t[n]-t[n-1]),s[n][n+1]=3*(e[n]-e[n-1])/((t[n]-t[n-1])*(t[n]-t[n-1])),this.solve(s,i)},solve:function(t,e){for(var i=t.length,n=0;i>n;n++){for(var s=0,a=Number.NEGATIVE_INFINITY,o=n;i>o;o++)t[o][n]>a&&(s=o,a=t[o][n]);this.splineSwapRows(t,n,s);for(var o=n+1;i>o;o++){for(var r=n+1;i+1>r;r++)t[o][r]=t[o][r]-t[n][r]*(t[o][n]/t[n][n]);t[o][n]=0}}for(var o=i-1;o>=0;o--){var h=t[o][i]/t[o][o];e[o]=h;for(var r=o-1;r>=0;r--)t[r][i]-=t[r][o]*h,t[r][o]=0}return e},zerosMat:function(t,e){for(var i=[],n=0;t>n;n++){i.push([]);for(var s=0;e>s;s++)i[n].push(0)}return i},splineSwapRows:function(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}}),window.ease=t}(),window.PLAYGROUND={},PLAYGROUND.MOBILE=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),PLAYGROUND.Utils={extend:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]},defaults:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])"undefined"==typeof arguments[0][e]&&(arguments[0][e]=arguments[t][e]);return arguments[0]},merge:function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i){var s=i[n];"undefined"!=typeof t[n]&&"object"==typeof t[n]?this.merge(t[n],s):t[n]=s}}return t},invoke:function(t,e){for(var i=Array.prototype.slice.call(arguments,2),n=0;n<t.length;n++){var s=t[n];s[e]&&s[e].apply(s,i)}},throttle:function(t,e){var i,n=0;return function(){for(var s=[],a=0;a<arguments.length;a++)s.push(arguments[a]);var o=this;Date.now()-n>e?(n=Date.now(),t.apply(o,s),clearTimeout(i)):(clearTimeout(i),i=setTimeout(function(){t.apply(o,s),n=Date.now()},Date.now()-n))}},wrapTo:function(t,e,i,n){if(t===e)return e;var s=t,a=this.wrappedDistance(t,e,i);return Math.abs(a)<n?e:(s+=(0>a?-1:1)*n,s>i?s-=i:0>s&&(s=i+s),s)},wrap:function(t,e,i){return e>t?i+t%i:t>=i?t%i:t},circWrap:function(t){return this.wrap(t,0,2*Math.PI)},circWrapTo:function(t,e,i){return this.wrapTo(t,e,2*Math.PI,i)},wrappedDistance:function(t,e,i){if(t===e)return 0;if(e>t)var n=-t-i+e,s=e-t;else var n=e-t,s=i-t+e;return Math.abs(n)>Math.abs(s)?s:n},circWrappedDistance:function(t,e){return this.wrappedDistance(t,e,2*Math.PI)},ground:function(t,e){return(t/e|0)*e},circDistance:function(t,e){return this.circWrappedDistance(t,e)},distance:function(t,e,i,n){if(arguments.length>2){var s=t-i,a=e-n;return Math.sqrt(s*s+a*a)}var s=t.x-e.x,a=t.y-e.y;return Math.sqrt(s*s+a*a)},sprintf:function(t,e){for(var i in e){var n=new RegExp("{"+i+"}","g");t=t.replace(n,e[i])}return t}},PLAYGROUND.Utils.ease=ease,PLAYGROUND.Events=function(){this.listeners={}},PLAYGROUND.Events.prototype={on:function(t,e,i){if("object"==typeof t){var n={};for(var s in t)n[s]=this.on(s,t[s],i);return n}this.listeners[t]||(this.listeners[t]=[]);var a={once:!1,callback:e,context:i};return this.listeners[t].push(a),a},once:function(t,e,i){if("object"==typeof t){var n={};for(var s in t)n[s]=this.once(s,t[s],i);return n}this.listeners[t]||(this.listeners[t]=[]);var a={once:!0,callback:e,context:i};return this.listeners[t].push(a),a},off:function(t,e){for(var i=0,n=this.listeners[t].length;n>i;i++)this.listeners[t][i]===e&&(this.listeners[t].splice(i--,1),n--)},trigger:function(t,e){if(this.listeners.event)for(var i=0,n=this.listeners.event.length;n>i;i++){var s=this.listeners.event[i];s.callback.call(s.context||this,t,e)}if(this.listeners[t])for(var i=0,n=this.listeners[t].length;n>i;i++){var s=this.listeners[t][i];s.callback.call(s.context||this,e),s.once&&(this.listeners[t].splice(i--,1),n--)}}},PLAYGROUND.States=function(t){this.app=t,PLAYGROUND.Events.call(this),t.on("step",this.step.bind(this))},PLAYGROUND.States.prototype={step:function(t){if(this.next&&(!this.current||!this.current.locked)){var e=this.next;"function"==typeof e&&(e=new e),e.__created||(e.__created=!0,e.app=this.app,this.trigger("createstate",{state:e}),e.create&&e.create()),this.current&&this.trigger("leavestate",{prev:this.current,next:e,state:this.current}),this.trigger("enterstate",{prev:this.current,next:e,state:e}),this.current=e,this.current&&this.current.enter&&this.current.enter(),this.app.state=this.current,this.next=!1}},set:function(t){this.current&&this.current.leave&&this.current.leave(),this.next=t,this.step(0)}},PLAYGROUND.Utils.extend(PLAYGROUND.States.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Application=function(t){function e(){i.loadFoo(.25),setTimeout(function(){i.emitLocalEvent("create"),i.setState(PLAYGROUND.DefaultState),i.handleResize(),PLAYGROUND.LoadingScreen&&i.setState(PLAYGROUND.LoadingScreen),PLAYGROUND.GameLoop(i),i.loader.once("ready",function(){i.firstBatch=!1,i.disabledUntilLoaded&&(i.skipEvents=!1),i.setState(PLAYGROUND.DefaultState),i.emitLocalEvent("ready"),i.handleResize()})})}var i=this;this.killed=!1,PLAYGROUND.Events.call(this),PLAYGROUND.Utils.merge(this,this.defaults,t),this.autoWidth=!this.width,this.autoHeight=!this.height,this.autoScale=!this.scale,this.container||(this.container=document.body),this.container!==document.body&&(this.customContainer=!0),"string"==typeof this.container&&(this.container=document.querySelector(this.container)),this.updateSize(),this.states=new PLAYGROUND.States(this),this.states.on("event",this.emitLocalEvent,this),this.mouse=new PLAYGROUND.Mouse(this,this.container),this.mouse.on("event",this.emitGlobalEvent,this),this.touch=new PLAYGROUND.Touch(this,this.container),this.touch.on("event",this.emitGlobalEvent,this),this.keyboard=new PLAYGROUND.Keyboard(this),this.keyboard.on("event",this.emitGlobalEvent,this),this.gamepads=new PLAYGROUND.Gamepads(this),this.gamepads.on("event",this.emitGlobalEvent,this),this.tweens=new PLAYGROUND.TweenManager(this),this.ease=PLAYGROUND.Utils.ease,PLAYGROUND.Sound(this),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),this.resizelistener=PLAYGROUND.Utils.throttle(this.handleResize.bind(this),100),window.addEventListener("resize",this.resizelistener),this.images={},this.atlases={},this.data={},this.loader=new PLAYGROUND.Loader(this),this.loadFoo(.25),this.plugins=[];for(var n in PLAYGROUND){var s=PLAYGROUND[n];s.plugin&&this.plugins.push(new s(this))}this.emitLocalEvent("preload"),this.firstBatch=!0,this.disabledUntilLoaded&&(this.skipEvents=!0),this.loader.once("ready",e)},PLAYGROUND.Application.prototype={defaults:{background:"#272822",smoothing:1,paths:{base:"",images:"images/",fonts:"fonts/"},offsetX:0,offsetY:0,skipEvents:!1,disabledUntilLoaded:!0},setState:function(t){this.states.set(t)},insertAsset:function(t,e,i){for(var n=i.split("/"),s=e,a=0;a<n.length-1;a++){var o=n[a];s[o]||(s[o]={}),s=s[o]}s[n.pop()]=t},getPath:function(t){return this.paths.base+(this.paths[t]||t+"/")},getAssetEntry:function(t,e,i){var e=this.paths[e]||e+"/",n=t.match(/(.*)\..*/),s=n?n[1]:t,a=t.split("."),o=t;if(a.length>1){var r=a.pop();t=a.join(".")}else{var r=i;o+="."+i}return{key:s,url:this.paths.base+e+o,path:this.paths.base+e+t,ext:r}},emitLocalEvent:function(t,e){this.trigger(t,e),"render"===t&&this.skipEvents&&!this.loader.ready||!this[t]||this[t](e)},emitGlobalEvent:function(t,e){return this.state?(this.trigger(t,e),"render"===t&&this.skipEvents&&!this.loader.ready||!this.event||this.event(t,e),"render"===t&&this.skipEvents&&!this.loader.ready||!this[t]||this[t](e),this.state.event&&this.state.event(t,e),this.state[t]&&this.state[t](e),void this.trigger("after"+t,e)):this.emitLocalEvent(t,e)},updateSize:function(){if(this.customContainer)var t=this.container.offsetWidth,e=this.container.offsetHeight;else var t=window.innerWidth,e=window.innerHeight;(this.autoScale||this.autoWidth||this.autoHeight)&&(!this.autoHeight&&this.autoWidth?(this.autoScale&&(this.scale=e/this.height),this.width=Math.ceil(t/this.scale)):!this.autoWidth&&this.autoHeight?(this.autoScale&&(this.scale=t/this.width),this.height=Math.ceil(e/this.scale)):this.autoWidth&&this.autoHeight&&this.autoScale?(this.scale=1,this.width=t,this.height=e):this.autoWidth&&this.autoHeight?(this.width=Math.ceil(t/this.scale),this.height=Math.ceil(e/this.scale)):this.scale=Math.min(t/this.width,e/this.height)),this.offsetX=(t-this.width*this.scale)/2|0,this.offsetY=(e-this.height*this.scale)/2|0,this.center={x:this.width/2|0,y:this.height/2|0}},handleVisibilityChange:function(){this.emitGlobalEvent("visibilitychange",{visible:!document.hidden,hidden:document.hidden})},handleResize:function(){this.emitGlobalEvent("beforeresize",{}),this.updateSize(),this.mouse.handleResize(),this.touch.handleResize(),this.emitGlobalEvent("resize",{})},request:function(t){function e(e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(n){var s=n.target;return 200!==s.status&&0!==s.status?i(new Error("Failed to get "+t)):void e(s)},n.send()}return new Promise(e)},loadFoo:function(t){var e=this.loader;this.loader.add("foo "+t),setTimeout(function(){e.success("foo "+t)},1e3*t)},loadData:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadData(e[i]);else this.loadDataItem(e)}},loadDataItem:function(t){function e(t){var e=i.key.indexOf("/")>-1;if("json"===i.ext){var s=JSON.parse(t.responseText);if(e){var a=i.key.split("/")[0];n.data[a]||(n.data[a]={}),PLAYGROUND.Utils.extend(n.data[a],s)}else n.data[i.key]||(n.data[i.key]={}),PLAYGROUND.Utils.defaults(n.data[i.key],s)}else if(e){var a=i.key.split("/")[0];n.data[a]||(n.data[a]=""),n.data[i.key]+=t.responseText}else n.data[i.key]=t.responseText;n.loader.success(i.url)}var i=this.getAssetEntry(t,"data","json"),n=this;this.loader.add(),this.request(i.url).then(e)},loadImage:function(){return this.loadImages.apply(this,arguments)},loadImages:function(){for(var t=[],e=0;e<arguments.length;e++){var i=arguments[e];if("object"==typeof i)for(var n in i)t=t.concat(this.loadImages(i[n]));else t.push(this.loadOneImage(i))}return Promise.all(t)},loadOneImage:function(t){var e=this;if(this._imageLoaders||(this._imageLoaders={}),!this._imageLoaders[t]){var i=function(i,n){var s=e.loader,a=e.getAssetEntry(t,"images","png");e.loader.add(a.path);var o=new Image;o.addEventListener("load",function(){e.images[a.key]=o,i(o),s.success(a.url),a.image=o,e.insertAsset(o,e.images,a.key),e.emitLocalEvent("imageready",a)}),o.addEventListener("error",function(){n("can't load "+a.url),s.error(a.url)}),o.src=a.url};e._imageLoaders[t]=new Promise(i)}return this._imageLoaders[t]},loadFont:function(){for(var t=[],e=0;e<arguments.length;e++){var i=arguments[e];t.push(this.loadFontItem(i))}return Promise.all(t)},loadFonts:function(){return this.loadFont.apply(this,arguments)},loadFontItem:function(t){if(!this.fontStyleSheet){var e=document.createElement("style");document.head.appendChild(e),this.fontStyleSheet=e}var i=this.getAssetEntry(t,"fonts","ttf"),n={woff:"woff",otf:"opentype",ttf:"truetype"}[i.ext],s="@font-face { font-family: '{name}'; font-style: 'normal'; font-weight: 400, 800; src: url(fonts/{name}.{ext}) format('{format}'); }",a=PLAYGROUND.Utils.sprintf(s,{name:t,ext:i.ext,format:n});this.fontStyleSheet.innerHTML+=a;var o=this;if(this._fontPromises||(this._fontPromises={}),!this._fontPromises[t]){var r=function(e,i){o.loader.add("font "+t);var n=setInterval(function(){var i=cq(100,32).font("14px somethingrandom").fillStyle("#fff").textBaseline("top");i.context.fillText("lorem ipsum dolores sit",0,4);var s=cq(100,32).font("14px '"+t+"'").fillStyle("#fff").textBaseline("top");s.context.fillText("lorem ipsum dolores sit",0,4),cq.compare(i,s)||(o.loader.success("font"+t),clearInterval(n),e())},100)};this._fontPromises[t]=new Promise(r)}return this._fontPromises[t]},render:function(){},enableInputs:function(){this.mouse.enabled=!0,this.touch.enabled=!0,this.keyboard.enabled=!0},disableInputs:function(){this.mouse.enabled=!1,this.touch.enabled=!1,this.keyboard.enabled=!1},kill:function(){this.killed=!0,this.trigger("kill"),window.removeEventListener("resize",this.resizelistener)}},PLAYGROUND.Utils.extend(PLAYGROUND.Application.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.GameLoop=function(t){function e(e){t.emitGlobalEvent("prerender",e),t.emitGlobalEvent("render",e),t.emitGlobalEvent("postrender",e)}function i(e){t.emitGlobalEvent("step",e)}function n(){if(!t.killed){if(requestAnimationFrame(n),t.frameskip){if(a++,a!==t.frameskip)return;a=0}var o=Date.now()-s;if(s=Date.now(),!(o>1e3)){var r=o/1e3;t.lifetime+=r,t.elapsed=r,i(r),e(r),t.opcost=o/1e3,t.ops=1e3/t.opcost}}}t.lifetime=0,t.ops=0,t.opcost=0;var s=Date.now(),a=0;requestAnimationFrame(n)},PLAYGROUND.Gamepads=function(t){this.app=t,PLAYGROUND.Events.call(this),this.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads,this.gamepadmoveEvent={},this.gamepaddownEvent={},this.gamepadupEvent={},this.gamepadholdEvent={},this.gamepads={},this.app.on("step",this.step.bind(this))},PLAYGROUND.Gamepads.prototype={buttons:{0:"1",1:"2",2:"3",3:"4",4:"l1",5:"r1",6:"l2",7:"r2",8:"select",9:"start",12:"up",13:"down",14:"left",15:"right"},zeroState:function(){for(var t=[],e=0;15>=e;e++)t.push({pressed:!1,value:0});return{axes:[],buttons:t}},createGamepad:function(){for(var t={buttons:{},sticks:[{x:0,y:0},{x:0,y:0}]},e=0;16>e;e++){var i=this.buttons[e];t.buttons[i]=!1}return t},step:function(){if(navigator.getGamepads)for(var t=navigator.getGamepads(),e=0;e<t.length;e++){var i=t[e];if(i){this[e]||(this[e]=this.createGamepad());for(var n=[].concat(i.buttons),s=12;15>=s;s++)n[s]={pressed:!1,value:0};var a=this[e];if(i.axes){Math.abs(i.axes[0])>.01&&(i.axes[0]<0&&(n[14].pressed=!0),i.axes[0]>0&&(n[15].pressed=!0)),Math.abs(i.axes[1])>.01&&(i.axes[1]<0&&(n[12].pressed=!0),i.axes[1]>0&&(n[13].pressed=!0));var o=!1,r=!1,h=!1;a.sticks[0].x!==i.axes[0]&&(o=!0,r=!0),a.sticks[0].y!==i.axes[1]&&(o=!0,r=!0),a.sticks[1].x!==i.axes[2]&&(o=!0,h=!0),a.sticks[1].y!==i.axes[3]&&(o=!0,h=!0),o&&(this.gamepadmoveEvent.old=[PLAYGROUND.Utils.extend({},a.sticks[0]),PLAYGROUND.Utils.extend({},a.sticks[1])],a.sticks[0].x=i.axes[0],a.sticks[0].y=i.axes[1],a.sticks[1].x=i.axes[2],a.sticks[1].y=i.axes[3],this.gamepadmoveEvent.sticks=a.sticks,r?this.gamepadmoveEvent.a=a.sticks[0]:this.gamepadmoveEvent.a=!1,h?this.gamepadmoveEvent.b=a.sticks[1]:this.gamepadmoveEvent.b=!1,this.gamepadmoveEvent.gamepad=e,this.trigger("gamepadmove",this.gamepadmoveEvent))}for(var c=0;c<n.length;c++){var u=this.buttons[c];n[c].pressed&&!a.buttons[u]&&(a.buttons[u]=!0,this.gamepaddownEvent.button=this.buttons[c],this.gamepaddownEvent.gamepad=e,this.trigger("gamepaddown",this.gamepaddownEvent)),n[c].pressed?(this.gamepadholdEvent.button=this.buttons[c],this.gamepadholdEvent.gamepad=e,this.gamepadholdEvent.dt=this.app.elapsed,this.trigger("gamepadhold",this.gamepadholdEvent)):!n[c].pressed&&a.buttons[u]&&(a.buttons[u]=!1,this.gamepadupEvent.button=this.buttons[c],this.gamepadupEvent.gamepad=e,this.trigger("gamepadup",this.gamepadupEvent))}}}}},PLAYGROUND.Utils.extend(PLAYGROUND.Gamepads.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Keyboard=function(t){PLAYGROUND.Events.call(this),this.app=t,this.keys={},this.any=!1,this.keydownlistener=this.keydown.bind(this),this.keyuplistener=this.keyup.bind(this),this.keypresslistener=this.keypress.bind(this),document.addEventListener("keydown",this.keydownlistener),document.addEventListener("keyup",this.keyuplistener),document.addEventListener("keypress",this.keypresslistener),this.keydownEvent={},this.keyupEvent={},this.keypressEvent={},this.preventDefault=!0,this.enabled=!0,this.app.on("kill",this.kill.bind(this))},PLAYGROUND.Keyboard.prototype={kill:function(){document.removeEventListener("keydown",this.keydownlistener),document.removeEventListener("keyup",this.keyuplistener),document.removeEventListener("keypress",this.keypresslistener)},keycodes:{37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",96:"numpad0",97:"numpad1",98:"numpad2",99:"numpad3",100:"numpad4",101:"numpad5",102:"numpad6",103:"numpad7",104:"numpad8",105:"numpad9",106:"numpadmul",107:"numpadadd",109:"numpadsub",110:"numpaddec",111:"numpaddiv",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},bypassKeys:["f12","f11","f5","ctrl","alt","shift"],keydown:function(t){if(this.enabled){if(t.which>=48&&t.which<=90)var e=String.fromCharCode(t.which).toLowerCase();else var e=this.keycodes[t.which];if(!this.keys[e]&&(this.any++,this.keydownEvent.key=e,this.keydownEvent.original=t,this.keys[e]=!0,this.trigger("keydown",this.keydownEvent),this.preventDefault&&document.activeElement===document.body)){var i=t.metaKey;if(!i)for(var n=0;n<this.bypassKeys.length;n++)if(this.keys[this.bypassKeys[n]]){i=!0;break}i||(t.preventDefault(),t.stopPropagation())}}},keyup:function(t){if(this.enabled){if(t.which>=48&&t.which<=90)var e=String.fromCharCode(t.which).toLowerCase();else var e=this.keycodes[t.which];this.any--,this.keyupEvent.key=e,this.keyupEvent.original=t,this.keys[e]=!1,this.trigger("keyup",this.keyupEvent)}},keypress:function(t){if(this.enabled){if(t.which>=48&&t.which<=90)var e=String.fromCharCode(t.which).toLowerCase();else var e=this.keycodes[t.which];this.keypressEvent.key=e,this.keypressEvent.original=t,this.trigger("keypress",this.keypressEvent)}}},PLAYGROUND.Utils.extend(PLAYGROUND.Keyboard.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Pointer=function(t){this.app=t,t.on("touchstart",this.touchstart,this),t.on("touchend",this.touchend,this),t.on("touchmove",this.touchmove,this),t.on("mousemove",this.mousemove,this),t.on("mousedown",this.mousedown,this),t.on("mouseup",this.mouseup,this),t.on("mousewheel",this.mousewheel,this),this.pointers=t.pointers={},this.lastTap=0},PLAYGROUND.Pointer.plugin=!0,PLAYGROUND.Pointer.prototype={updatePointer:function(t){this.pointers[t.id]||(this.pointers[t.id]={});var e=this.pointers[t.id];return e.x=t.x,e.y=t.y,e.id=t.id,e},removePointer:function(t){delete this.pointers[t.id]},touchstart:function(t){t.touch=!0,this.updatePointer(t),this.pointerdown(t),this.app.emitGlobalEvent("pointerdown",t)},touchend:function(t){t.touch=!0,this.pointerup(t),this.removePointer(t),this.app.emitGlobalEvent("pointerup",t)},touchmove:function(t){t.touch=!0,this.updatePointer(t),this.pointermove(t),this.app.emitGlobalEvent("pointermove",t)},mousemove:function(t){t.mouse=!0,this.updatePointer(t),this.pointermove(t),this.app.emitGlobalEvent("pointermove",t)},mousedown:function(t){t.mouse=!0,this.updatePointer(t),this.app.emitGlobalEvent("pointerdown",t),this.pointerdown(t)},mouseup:function(t){t.mouse=!0,this.pointerup(t),this.app.emitGlobalEvent("pointerup",t)},mousewheel:function(t){t.mouse=!0,this.app.emitGlobalEvent("pointerwheel",t)},pointerdown:function(t){var e=this.pointers[t.id];e.pressed=!0;var i=this.app.lifetime-e.lastTap;e.lastTap=this.app.lifetime,.4>i&&e.tapPosition&&PLAYGROUND.Utils.distance(e,e.tapPosition)<5&&(this.app.emitGlobalEvent("pointerdoubletap",e),e.lastTap=0),e.tapPosition={x:t.x,y:t.y}},pointermove:function(t){var e=this.pointers[t.id];!e.dragging&&e.pressed&&PLAYGROUND.Utils.distance(e.tapPosition,t)>5&&(e.dragging=!0),t.dragging=e.dragging},pointerup:function(t){var e=this.pointers[t.id];e.pressed=!1,e.dragging=!1}},PLAYGROUND.Loader=function(t){this.app=t,PLAYGROUND.Events.call(this),this.reset()},PLAYGROUND.Loader.prototype={add:function(t){return this.queue++,this.count++,this.ready=!1,this.trigger("add",t),t},error:function(t){this.trigger("error",t)},success:function(t){this.queue--,this.progress=1-this.queue/this.count,this.trigger("load",t),this.queue<=0&&(this.reset(),this.trigger("ready"))},reset:function(){this.progress=0,this.queue=0,this.count=0,this.ready=!0}},PLAYGROUND.Utils.extend(PLAYGROUND.Loader.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Mouse=function(t,e){var i=this;this.app=t,PLAYGROUND.Events.call(this),this.element=e,this.preventContextMenu=!0,this.enabled=!0,this.mousemoveEvent={},this.mousedownEvent={},this.mouseupEvent={},this.mousewheelEvent={},this.x=0,this.y=0,this.mousemovelistener=this.mousemove.bind(this),this.mousedownlistener=this.mousedown.bind(this),this.mouseuplistener=this.mouseup.bind(this),this.mouseoutlistener=this.mouseout.bind(this),this.contextmenulistener=function(t){i.preventContextMenu&&!t.metaKey&&t.preventDefault()},e.addEventListener("mousemove",this.mousemovelistener),e.addEventListener("mousedown",this.mousedownlistener),e.addEventListener("mouseup",this.mouseuplistener),e.addEventListener("mouseout",this.mouseoutlistener),e.addEventListener("contextmenu",this.contextmenulistener),this.app.on("kill",this.kill.bind(this)),this.enableMousewheel(),e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,this.handleResize()},PLAYGROUND.Mouse.prototype={kill:function(){this.element.removeEventListener("mousemove",this.mousemovelistener),this.element.removeEventListener("mousedown",this.mousedownlistener),this.element.removeEventListener("mouseup",this.mouseuplistener),this.element.removeEventListener("mouseout",this.mouseoutlistener),this.element.removeEventListener("contextmenu",this.contextmenulistener)},mouseout:function(t){for(var e=0;3>e;e++)this.mouseup({button:e})},lock:function(){this.locked=!0,this.element.requestPointerLock()},unlock:function(){this.locked=!1,document.exitPointerLock()},getElementOffset:function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},mousemove:PLAYGROUND.Utils.throttle(function(t){this.enabled&&(this.x=this.mousemoveEvent.x=(t.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=this.mousemoveEvent.y=(t.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,this.mousemoveEvent.original=t,this.locked&&(this.mousemoveEvent.movementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.mousemoveEvent.movementY=t.movementY||t.mozMovementY||t.webkitMovementY||0),this.app.mouseToTouch?(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("touchmove",this.mousemoveEvent)):(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("mousemove",this.mousemoveEvent)))},15),mousedown:function(t){if(this.enabled){var e=["left","middle","right"][t.button];this.mousedownEvent.x=this.mousemoveEvent.x,this.mousedownEvent.y=this.mousemoveEvent.y,this.mousedownEvent.button=e,this.mousedownEvent.original=t,this[e]=!0,this.mousedownEvent.id=this.mousedownEvent.identifier=255,this.app.mouseToTouch?(this.trigger("touchmove",this.mousedownEvent),this.trigger("touchstart",this.mousedownEvent)):this.trigger("mousedown",this.mousedownEvent)}},mouseup:function(t){if(this.enabled){var e=["left","middle","right"][t.button];this[e]&&(this.mouseupEvent.x=this.mousemoveEvent.x,this.mouseupEvent.y=this.mousemoveEvent.y,this.mouseupEvent.button=e,this.mouseupEvent.original=t,this.mouseupEvent.id=this.mouseupEvent.identifier=255,this.app.mouseToTouch?this.trigger("touchend",this.mouseupEvent):this.trigger("mouseup",this.mouseupEvent),this[e]=!1)}},mousewheel:function(t){this.mousewheelEvent.x=this.mousemoveEvent.x,this.mousewheelEvent.y=this.mousemoveEvent.y,this.mousewheelEvent.button=["none","left","middle","right"][t.button],this.mousewheelEvent.original=t,this.mousewheelEvent.id=this.mousewheelEvent.identifier=255,this[t.button]=!1,this.trigger("mousewheel",this.mousewheelEvent)},enableMousewheel:function(){for(var t=("onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]),e=this.mousewheel.bind(this),i=this,n=PLAYGROUND.Utils.throttle(function(t){var n=t||window.event,s=([].slice.call(arguments,1),0),a=0;n.wheelDelta&&(s=n.wheelDelta),n.detail&&(s=-1*n.detail),n.deltaY&&(a=-1*n.deltaY,s=a),void 0!==n.wheelDeltaY&&(a=n.wheelDeltaY);var o=s?s:a;i.mousewheelEvent.x=i.mousemoveEvent.x,i.mousewheelEvent.y=i.mousemoveEvent.y,i.mousewheelEvent.delta=o/Math.abs(o),i.mousewheelEvent.original=n,e(i.mousewheelEvent),n.preventDefault()},40),s=t.length;s;)i.element.addEventListener(t[--s],function(t){n(t),t.preventDefault(),t.stopPropagation()},!1)}},PLAYGROUND.Utils.extend(PLAYGROUND.Mouse.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Sound=function(t){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;e&&!t.forceAudioFallback?(PLAYGROUND.audioContext||(PLAYGROUND.audioContext=new e),t.audioContext=PLAYGROUND.audioContext,t.sound=new PLAYGROUND.SoundWebAudioAPI(t,t.audioContext),t.music=new PLAYGROUND.SoundWebAudioAPI(t,t.audioContext)):(t.sound=new PLAYGROUND.SoundAudio(t),t.music=new PLAYGROUND.SoundAudio(t))},PLAYGROUND.Application.prototype.playSound=function(t,e){return this.sound.play(t,e)},PLAYGROUND.Application.prototype.stopSound=function(t){this.sound.stop(t)},PLAYGROUND.Application.prototype.loadSound=function(){return this.loadSounds.apply(this,arguments)},PLAYGROUND.Application.prototype.loadSounds=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadSounds(e[i]);else this.sound.load(e)}},function t(e,i,n){function s(o,r){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!r&&h)return h(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return s(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){(function(e){"use strict";var i=e.AudioContext||e.webkitAudioContext,n=t("stereo-panner-node");i&&!i.prototype.createStereoPanner&&(i.prototype.createStereoPanner=function(){return new n(this)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"stereo-panner-node":4}],2:[function(t,e,i){"use strict";var n=4096,s=new Float32Array(n),a=new Float32Array(n);!function(){for(var t=0;n>t;t++)s[t]=Math.cos(t/n*Math.PI*.5),a[t]=Math.sin(t/n*Math.PI*.5)}(),e.exports={L:s,R:a}},{}],3:[function(t,e,i){(function(i){"use strict";function n(t){this.audioContext=t,this.inlet=t.createChannelSplitter(2),this._pan=t.createGain(),this.pan=this._pan.gain,this._wsL=t.createWaveShaper(),this._wsR=t.createWaveShaper(),this._L=t.createGain(),this._R=t.createGain(),this.outlet=t.createChannelMerger(2),this.inlet.channelCount=2,this.inlet.channelCountMode="explicit",this._pan.gain.value=0,this._wsL.curve=s.L,this._wsR.curve=s.R,this._L.gain.value=0,this._R.gain.value=0,this.inlet.connect(this._L,0),this.inlet.connect(this._R,1),this._L.connect(this.outlet,0,0),this._R.connect(this.outlet,0,1),this._pan.connect(this._wsL),this._pan.connect(this._wsR),this._wsL.connect(this._L.gain),this._wsR.connect(this._R.gain),this._isConnected=!1,this._dc1buffer=null,this._dc1=null}var s=t("./curve");n.prototype.connect=function(t){var e=this.audioContext;this._isConnected||(this._isConnected=!0,this._dc1buffer=e.createBuffer(1,2,e.sampleRate),this._dc1buffer.getChannelData(0).set([1,1]),this._dc1=e.createBufferSource(),this._dc1.buffer=this._dc1buffer,this._dc1.loop=!0,this._dc1.start(e.currentTime),
this._dc1.connect(this._pan)),i.AudioNode.prototype.connect.call(this.outlet,t)},n.prototype.disconnect=function(){var t=this.audioContext;this._isConnected&&(this._isConnected=!1,this._dc1.stop(t.currentTime),this._dc1.disconnect(),this._dc1=null,this._dc1buffer=null),i.AudioNode.prototype.disconnect.call(this.outlet)},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./curve":2}],4:[function(t,e,i){"use strict";function n(t){var e=new s(t);return Object.defineProperties(e.inlet,{pan:{value:e.pan,enumerable:!0},connect:{value:function(t){return e.connect(t)}},disconnect:{value:function(){return e.disconnect()}}}),e.inlet}var s=t("./stereo-panner-impl");e.exports=n},{"./stereo-panner-impl":3}]},{},[1]),PLAYGROUND.SoundWebAudioAPI=function(t,e){this.app=t;var i=(new Audio).canPlayType("audio/mp3"),n=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');"mp3"===this.app.preferedAudioFormat?i?this.audioFormat="mp3":this.audioFormat="ogg":n?this.audioFormat="ogg":this.audioFormat="mp3",this.context=e,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.compressor=this.context.createDynamicsCompressor(),this.compressor.connect(this.gainNode),this.output=this.compressor,this.gainNode.gain.value=1,this.pool=[],this.volume=1,this.loops=[],this.app.on("step",this.step.bind(this))},PLAYGROUND.SoundWebAudioAPI.prototype={buffers:{},aliases:{},alias:function(t,e,i,n){this.aliases[t]={source:e,volume:i,rate:n}},setMaster:function(t){this.volume=t,this.gainNode.gain.value=t},load:function(t){var e=this.app.getAssetEntry(t,"sounds",this.audioFormat),i=this,n=new XMLHttpRequest;n.open("GET",e.url,!0),n.responseType="arraybuffer";this.app.loader.add(e.url);n.onload=function(){i.context.decodeAudioData(this.response,function(t){i.buffers[e.key]=t,i.app.loader.success(e.url)})},n.send()},cleanArray:function(t,e){for(var i=0,n=t.length;n>i;i++)(null===t[i]||e&&t[i][e])&&(t.splice(i--,1),n--)},getSoundBuffer:function(){if(!this.pool.length)for(var t=0;100>t;t++){var e,i,n,s=[e=this.context.createBufferSource(),i=this.context.createGain(),n=this.context.createStereoPanner()];this.pool.push(s),PLAYGROUND.MOBILE?(s[0].connect(s[1]),s[1].connect(this.gainNode)):(s[0].connect(s[1]),s[1].connect(s[2]),s[2].connect(this.output))}return this.pool.pop()},play:function(t,e){var i=this.aliases[t],n=this.getSoundBuffer();return i&&(t=i.source),bufferSource=n[0],bufferSource.gainNode=n[1],bufferSource.pannerNode=n[2],bufferSource.buffer=this.buffers[t],bufferSource.loop=e||!1,bufferSource.key=t,bufferSource.alias=i,this.setVolume(bufferSource,1),this.setPlaybackRate(bufferSource,1),this.loop,bufferSource.start(0),bufferSource.volumeLimit=1,bufferSource},stop:function(t){t&&t.stop(0)},setPlaybackRate:function(t,e){return t?(t.alias&&(e*=t.alias.rate),t.playbackRate.value=e):void 0},getVolume:function(t){return t?t.gainNode.gain.value:void 0},setVolume:function(t,e){return t?(t.alias&&(e*=t.alias.volume),t.gainNode.gain.value=Math.max(0,e)):void 0},setPanning:function(t,e){t.pannerNode.pan.value=e},getPanning:function(t){return t.pannerNode.pan.value},fadeOut:function(t){return t?(t.fadeOut=!0,this.loops.push(t),t):void 0},fadeIn:function(t){return t?(t.fadeIn=!0,this.loops.push(t),this.setVolume(t,0),t):void 0},step:function(t){for(var e=0;e<this.loops.length;e++){var i=this.loops[e];if(i.fadeIn){var n=this.getVolume(i);n=this.setVolume(i,Math.min(1,n+.5*t)),n>=1&&this.loops.splice(e--,1)}if(i.fadeOut){var n=this.getVolume(i);n=this.setVolume(i,Math.min(1,n-.5*t)),0>=n&&(this.loops.splice(e--,1),this.stop(i))}}}},PLAYGROUND.SoundAudio=function(t){this.app=t;var e=(new Audio).canPlayType("audio/mp3"),i=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');"mp3"===this.app.preferedAudioFormat?e?this.audioFormat="mp3":this.audioFormat="ogg":i?this.audioFormat="ogg":this.audioFormat="mp3"},PLAYGROUND.SoundAudio.prototype={samples:{},setMaster:function(t){this.volume=t},setMasterPosition:function(){},setPosition:function(t,e,i){},load:function(t){console.log(t,this.audioFormat);var e="sounds/"+t+"."+this.audioFormat,i=this.app.loader;this.app.loader.add(e);var n=this.samples[t]=new Audio;n.addEventListener("canplay",function(){console.log("CANPLAY"),this.pause(),i.success(e)}),n.addEventListener("error",function(){i.error(e)}),n.src=e,n.play()},play:function(t,e){var i=this.samples[t];return i.currentTime=0,i.loop=e,i.play(),i},stop:function(t){t&&t.pause()},step:function(t){},setPlaybackRate:function(t,e){},setVolume:function(t,e){t.volume=e*this.volume},setPosition:function(){},setPanning:function(t,e){}},PLAYGROUND.Touch=function(t,e){PLAYGROUND.Events.call(this),this.app=t,this.element=e,this.touches={},this.enabled=!0,this.x=0,this.y=0,this.touchmovelistener=this.touchmove.bind(this),this.touchstartlistener=this.touchstart.bind(this),this.touchendlistener=this.touchend.bind(this),e.addEventListener("touchmove",this.touchmovelistener),e.addEventListener("touchstart",this.touchstartlistener),e.addEventListener("touchend",this.touchendlistener),this.app.on("kill",this.kill.bind(this))},PLAYGROUND.Touch.prototype={kill:function(){this.element.removeEventListener("touchmove",this.touchmovelistener),this.element.removeEventListener("touchstart",this.touchstartlistener),this.element.removeEventListener("touchend",this.touchendlistener)},getElementOffset:function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},touchmove:function(t){if(this.enabled){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];touchmoveEvent={},this.x=touchmoveEvent.x=(i.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=touchmoveEvent.y=(i.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,touchmoveEvent.original=i,touchmoveEvent.id=touchmoveEvent.identifier=i.identifier,this.touches[i.identifier].x=touchmoveEvent.x,this.touches[i.identifier].y=touchmoveEvent.y,this.trigger("touchmove",touchmoveEvent)}t.preventDefault()}},touchstart:function(t){if(this.enabled){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n={};this.x=n.x=(i.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=n.y=(i.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,n.original=t.touch,n.id=n.identifier=i.identifier,this.touches[i.identifier]={x:n.x,y:n.y},this.trigger("touchstart",n)}t.preventDefault()}},touchend:function(t){if(this.enabled){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n={};n.x=(i.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,n.y=(i.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,n.original=i,n.id=n.identifier=i.identifier,delete this.touches[i.identifier],this.trigger("touchend",n)}t.preventDefault()}}},PLAYGROUND.Utils.extend(PLAYGROUND.Touch.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Tween=function(t,e){PLAYGROUND.Events.call(this),this.manager=t,this.context=e,PLAYGROUND.Utils.extend(this,{prevEasing:"045",prevDuration:.5}),this.clear()},PLAYGROUND.Tween.prototype={add:function(t,e,i){return"undefined"!=typeof e?this.prevDuration=e:e=.5,i?this.prevEasing=i:i="045",this.actions.push([t,e,i]),this},clear:function(){return this.actions=[],this.index=-1,this.current=!1,this},discard:function(){return this.manager.discard(this.context,this),this},to:function(t,e,i){return this.add(t,e,i)},call:function(t,e){for(var i=["call",t,e||this.context],n=2;n<arguments.length;n++)i.push(arguments[n]);return this.actions.push(i),this},loop:function(){return this.looped=!0,this},repeat:function(t){return this.actions.push(["repeat",t]),this},wait:function(t){return this.actions.push(["wait",t]),this},delay:function(t){return this.actions.push(["wait",t]),this},stop:function(){return this.manager.remove(this),this},play:function(){return this.manager.add(this),this.finished=!1,this},end:function(){for(var t=0,e=this.index+1;e<this.actions.length;e++)"object"==typeof this.actions[e][0]&&(t=e);return this.index=t-1,this.next(),this.delta=this.duration,this.step(0),this},forward:function(){this.delta=this.duration,this.step(0)},rewind:function(){this.delta=0,this.step(0)},next:function(){if(this.delta=0,this.index++,this.index>=this.actions.length){if(!this.looped)return void this.manager.remove(this);this.trigger("loop",{tween:this}),this.index=0}if(this.current=this.actions[this.index],"call"===this.current[0]){var t=this.current.slice(2),e=this.current[1],i=this.current[2],n=i[e];n.apply(i,t)}else if("wait"===this.current[0])this.duration=this.current[1],this.currentAction="wait";else{var s=this.current[0];this.keys=Object.keys(s),this.change=[],this.before=[],this.types=[];for(var a=0;a<this.keys.length;a++){var o=this.keys[a],r=this.context[o];if("number"==typeof s[o])r=r||0,this.before.push(r),this.change.push(s[o]-r),this.types.push(0);else if("string"==typeof s[o]&&s[o].indexOf("rad")>-1)r=r||0,this.before.push(r),this.change.push(PLAYGROUND.Utils.circWrappedDistance(r,parseFloat(s[o]))),this.types.push(2);else{r=r||"#000";var h=cq.color(r);this.before.push(h);for(var c=cq.color(s[o]),u=[],l=0;3>l;l++)u.push(c[l]-h[l]);this.change.push(u),this.types.push(1)}}this.currentAction="animate",this.duration=this.current[1],this.easing=this.current[2]}},prev:function(){},step:function(t){switch(this.delta+=t,this.current||this.next(),this.currentAction){case"animate":this.doAnimate(t);break;case"wait":this.doWait(t)}},doAnimate:function(t){this.progress=this.duration?Math.min(1,this.delta/this.duration):1;for(var e=PLAYGROUND.Utils.ease(this.progress,this.easing),i=0;i<this.keys.length;i++){var n=this.keys[i];switch(this.types[i]){case 0:this.context[n]=this.before[i]+this.change[i]*e;break;case 1:for(var s=this.change[i],a=this.before[i],o=[],r=0;3>r;r++)o.push(a[r]+s[r]*e|0);this.context[n]="rgb("+o.join(",")+")";break;case 2:this.context[n]=PLAYGROUND.Utils.circWrap(this.before[i]+this.change[i]*e)}}this.progress>=1&&this.next(),this.listeners.step&&this.trigger("step",{tween:this,dt:t})},doWait:function(t){this.delta>=this.duration&&this.next()},onremove:function(){this.trigger("finished",{tween:this}),this.trigger("finish",{tween:this}),this.finished=!0}},PLAYGROUND.Utils.extend(PLAYGROUND.Tween.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.TweenManager=function(t){this.tweens=[],t&&(this.app=t,this.app.tween=this.tween.bind(this)),this.delta=0,this.app.on("step",this.step.bind(this))},PLAYGROUND.TweenManager.prototype={defaultEasing:"128",circ:function(t){return{type:"circ",value:t}},discard:function(t,e){for(var i=0;i<this.tweens.length;i++){var n=this.tweens[i];n.context===t&&n!==e&&this.remove(n)}},tween:function(t){var e=new PLAYGROUND.Tween(this,t);return this.add(e),e},step:function(t){this.delta+=t;for(var e=0;e<this.tweens.length;e++){var i=this.tweens[e];i._remove||i.step(t),i._remove&&this.tweens.splice(e--,1)}},add:function(t){t._remove=!1;var e=this.tweens.indexOf(t);-1===e&&this.tweens.push(t)},remove:function(t){t._remove||(t._remove=!0,t.onremove())}},PLAYGROUND.Application.prototype.loadAtlases=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadAtlases(e[i]);else this._loadAtlas(e)}},PLAYGROUND.Application.prototype.loadAtlas=function(){return this.loadAtlases.apply(this,arguments)},PLAYGROUND.Application.prototype._loadAtlas=function(t){var e=this.getAssetEntry(t,"atlases","png");this.loader.add(e.url);var i=this.atlases[e.key]={},n=i.image=new Image;n.addEventListener("load",function(){a.success(e.url)}),n.addEventListener("error",function(){a.error(e.url)}),n.src=e.url;var s=new XMLHttpRequest;s.open("GET",e.path+".json",!0),this.loader.add(e.path+".json");var a=this.loader;s.onload=function(){var t=JSON.parse(this.response);i.frames=[];for(var n=0;n<t.frames.length;n++){var s=t.frames[n];i.frames.push({region:[s.frame.x,s.frame.y,s.frame.w,s.frame.h],offset:[s.spriteSourceSize.x||0,s.spriteSourceSize.y||0],width:s.sourceSize.w,height:s.sourceSize.h})}a.success(e.path+".json")},s.send()},PLAYGROUND.Application.prototype.loadFontOld=function(t){function e(){var i=cq(32,32);i.font("10px "+t).fillText(16,16,16),i.trim(),i.width!==h||i.height!==c?u.loader.ready("font "+t):setTimeout(e,250)}var i=document.createElement("style");i.type="text/css";var n={woff:"woff",ttf:"truetype"},s="";for(var a in n){var o=n[a];s+=' url("fonts/'+t+"."+a+"\") format('"+o+"');"}i.textContent="@font-face { font-family: '"+t+"'; src: "+s+" }",document.head.appendChild(i);var r=cq(32,32);r.font("10px Testing"),r.fillText(16,16,16).trim();var h=r.width,c=r.height;this.loader.add("font "+t);var u=this;e()},PLAYGROUND.DefaultState={},PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var t=this;this.logo=new Image,this.logo.addEventListener("load",function(){t.ready=!0,t.createElements()}),this.logo.src=this.logoRaw,this.background="#000",window.getComputedStyle&&(this.background=window.getComputedStyle(document.body).backgroundColor||"#000")},enter:function(){this.current=0},leave:function(){this.locked=!0,this.animation=this.app.tween(this).to({current:1},.5)},step:function(t){this.locked?this.animation.finished&&(this.locked=!1,this.wrapper.parentNode.removeChild(this.wrapper)):this.current=this.current+Math.abs(this.app.loader.progress-this.current)*t},createElements:function(){this.width=.6*window.innerWidth|0,this.height=.1*window.innerHeight|0,this.wrapper=document.createElement("div"),this.wrapper.style.width=this.width+"px",this.wrapper.style.height=this.height+"px",this.wrapper.style.background="#000",this.wrapper.style.border="4px solid #fff",this.wrapper.style.position="absolute",this.wrapper.style.left=(window.innerWidth/2-this.width/2|0)+"px",this.wrapper.style.top=(window.innerHeight/2-this.height/2|0)+"px",this.wrapper.style.zIndex=100,this.app.container.appendChild(this.wrapper),this.progressBar=document.createElement("div"),this.progressBar.style.width="0%",this.progressBar.style.height=this.height+"px",this.progressBar.style.background="#fff",this.wrapper.appendChild(this.progressBar)},render:function(){this.ready&&(this.progressBar.style.width=(100*this.current|0)+"%")}},function(){var t=!1,e=window.HTMLCanvasElement,i=(window.Image,window.HTMLImageElement),n=window.ImageBitmap||window.HTMLImageElement,t=navigator.isCocoonJS,s=function(t){if(0===arguments.length){var e=s.pool();e.width=window.innerWidth,e.height=window.innerHeight}else if("string"==typeof t)var e=document.querySelector(t);else if("number"==typeof t){var e=s.pool();e.width=arguments[0],e.height=arguments[1]}else if(t instanceof i){var e=s.pool();e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0)}else if(t instanceof n){var e=s.pool();e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0)}else{if(t instanceof s.Layer)return t;var e=t}return new s.Layer(e)};s.lineSpacing=1,s.defaultFont="",s.textBaseline="alphabetic",s.matchPalettePrecision=10,s.palettes={db16:["#140c1c","#442434","#30346d","#4e4a4e","#854c30","#346524","#d04648","#757161","#597dce","#d27d2c","#8595a1","#6daa2c","#d2aa99","#6dc2ca","#dad45e","#deeed6"],db32:["#000000","#222034","#45283c","#663931","#8f563b","#df7126","#d9a066","#eec39a","#fbf236","#99e550","#6abe30","#37946e","#4b692f","#524b24","#323c39","#3f3f74","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffffff","#9badb7","#847e87","#696a6a","#595652","#76428a","#ac3232","#d95763","#d77bba","#8f974a","#8a6f30"],c64:["#000000","#6a5400","#68ae5c","#8a8a8a","#adadad","#636363","#c37b75","#c9d684","#ffffff","#984b43","#a3e599","#79c1c8","#9b6739","#9b51a5","#52429d","#8a7bce"],gameboy:["#0f380f","#306230","#8bac0f","#9bbc0f"],sega:["#000000","#555500","#005500","#555555","#55aa00","#550000","#aaffaa","#aaaaaa","#ff5555","#005555","#550055","#aaaa55","#ffffaa","#aa5555","#ffaa55","#ffff55","#ffffff","#ffaaaa","#000055","#55aaaa","#aa0000","#ff5500","#ffaa00","#aa5500","#ff0000","#ffaaff","#aa55aa","#aaaa00","#aaff00","#aaaaff","#5555aa","#aaffff"],cga:["#000000","#ff5555","#55ff55","#ffff55"],nes:["#7C7C7C","#0000FC","#0000BC","#4428BC","#940084","#A80020","#A81000","#881400","#503000","#007800","#006800","#005800","#004058","#000000","#000000","#000000","#BCBCBC","#0078F8","#0058F8","#6844FC","#D800CC","#E40058","#F83800","#E45C10","#AC7C00","#00B800","#00A800","#00A844","#008888","#000000","#000000","#000000","#F8F8F8","#3CBCFC","#6888FC","#9878F8","#F878F8","#F85898","#F87858","#FCA044","#F8B800","#B8F818","#58D854","#58F898","#00E8D8","#787878","#000000","#000000","#FCFCFC","#A4E4FC","#B8B8F8","#D8B8F8","#F8B8F8","#F8A4C0","#F0D0B0","#FCE0A8","#F8D878","#D8F878","#B8F8B8","#B8F8D8","#00FCFC","#F8D8F8","#000000"]},s.cocoon=function(t){if(0===arguments.length){var e=s.createCocoonCanvas(window.innerWidth,window.innerHeight);window.addEventListener("resize",function(){})}else if("string"==typeof t)var e=document.querySelector(t);else if("number"==typeof t)var e=s.createCocoonCanvas(arguments[0],arguments[1]);else if(t instanceof i)var e=s.createCocoonCanvas(t);else{if(t instanceof s.Layer)return t;var e=t}return new s.Layer(e)},s.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]},s.augment=function(){for(var t=1;t<arguments.length;t++)_.extend(arguments[0],arguments[t]),arguments[t](arguments[0])},s.distance=function(t,e,i,n){if(arguments.length>2){var s=t-i,a=e-n;return Math.sqrt(s*s+a*a)}return Math.abs(t-e)},s.fastApply=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2]);case 4:return t.call(e,i[0],i[1],i[2],i[3]);case 5:return t.call(e,i[0],i[1],i[2],i[3],i[4]);case 6:return t.call(e,i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return t.call(e,i[0],i[1],i[2],i[3],i[4],i[5],i[6]);case 8:return t.call(e,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]);case 9:return t.call(e,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8]);default:return t.apply(e,i)}},s.extend(s,{smoothing:!0,blend:function(t,e,i,n){"undefined"==typeof n&&(n=1);var t=s(t),a=t.clone(),e=s(e);return t.save(),t.globalAlpha(n),t.globalCompositeOperation(i),t.drawImage(e.canvas,0,0),t.restore(),a.save(),a.globalCompositeOperation("source-in"),a.drawImage(t.canvas,0,0),a.restore(),a},matchColor:function(t,e){for(var i=[],n=0;n<e.length;n++)i.push(s.color(e[n]));for(var a=s.color(t),o=[],r=0;r<i.length;r++){var h=i[r],c=Math.abs(a[0]-h[0]),u=Math.abs(a[1]-h[1]),l=Math.abs(a[2]-h[2]);o.push(c+u+l)}for(var f=0,r=0;r<e.length;r++)o[r]<o[f]&&(f=r);return e[f]},temp:function(t,a){return this.tempLayer||(this.tempLayer=s(1,1)),t instanceof i||t instanceof n?(this.tempLayer.width=t.width,this.tempLayer.height=t.height,this.tempLayer.context.drawImage(t,0,0)):t instanceof e?(this.tempLayer.width=t.width,this.tempLayer.height=t.height,this.tempLayer.context.drawImage(t,0,0)):t instanceof CanvasQuery.Layer?(this.tempLayer.width=t.width,this.tempLayer.height=t.height,this.tempLayer.context.drawImage(t.canvas,0,0)):(this.tempLayer.width=t,this.tempLayer.height=a),this.tempLayer},wrapValue:function(t,e,i){return e>t?i+t%i:t>=i?t%i:t},limitValue:function(t,e,i){return e>t?e:t>i?i:t},mix:function(t,e,i){return t+(e-t)*i},hexToRgb:function(t){return 7===t.length?["0x"+t[1]+t[2]|0,"0x"+t[3]+t[4]|0,"0x"+t[5]+t[6]|0]:["0x"+t[1]+t[1]|0,"0x"+t[2]+t[2]|0,"0x"+t[3]+t[3]|0]},rgbToHex:function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1,7)},extractCanvas:function(t){return t.canvas?t.canvas:t},compare:function(t,e){if(t=this.extractCanvas(t),e=this.extractCanvas(e),t=t.getContext("2d").getImageData(0,0,t.width,t.height).data,e=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},rgbToHsl:function(t,e,i){t instanceof Array&&(i=t[2],e=t[1],t=t[0]),t/=255,e/=255,i/=255;var n,s,a=Math.max(t,e,i),o=Math.min(t,e,i),r=(a+o)/2;if(a==o)n=s=0;else{var h=a-o;switch(s=r>.5?h/(2-a-o):h/(a+o),a){case t:n=(e-i)/h+(i>e?6:0);break;case e:n=(i-t)/h+2;break;case i:n=(t-e)/h+4}n/=6}return[n,s,r]},hue2rgb:function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t},hslToRgb:function(t,e,i){var n,s,a;if(0==e)n=s=a=i;else{var o=.5>i?i*(1+e):i+e-i*e,r=2*i-o;n=this.hue2rgb(r,o,t+1/3),s=this.hue2rgb(r,o,t),a=this.hue2rgb(r,o,t-1/3)}return[255*n|0,255*s|0,255*a|0]},rgbToHsv:function(t,e,i){t instanceof Array&&(i=t[2],e=t[1],t=t[0]),t/=255,e/=255,i/=255;var n,s,a=Math.max(t,e,i),o=Math.min(t,e,i),r=a,h=a-o;if(s=0==a?0:h/a,a==o)n=0;else{switch(a){case t:n=(e-i)/h+(i>e?6:0);break;case e:n=(i-t)/h+2;break;case i:n=(t-e)/h+4}n/=6}return[n,s,r]},hsvToRgb:function(t,e,i){var n,s,a,o=Math.floor(6*t),r=6*t-o,h=i*(1-e),c=i*(1-r*e),u=i*(1-(1-r)*e);switch(o%6){case 0:n=i,s=u,a=h;break;case 1:n=c,s=i,a=h;break;case 2:n=h,s=i,a=u;break;case 3:n=h,s=c,a=i;break;case 4:n=u,s=h,a=i;break;case 5:n=i,s=h,a=c}return[255*n,255*s,255*a]},color:function(){var t=new s.Color;return t.parse(arguments[0],arguments[1]),t},poolArray:[],pool:function(){if(!this.poolArray.length)for(var t=0;100>t;t++)this.poolArray.push(this.createCanvas(1,1));return this.poolArray.pop()},reuse:function(t){return this.recycle(t)},recycle:function(t){t instanceof CanvasQuery.Layer?this.poolArray.push(t.canvas):this.poolArray.push(t)},setContextSmoothing:function(t,e){t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.imageSmoothingEnabled=e},createCanvas:function(t,s){var a=document.createElement("canvas");if(arguments[0]instanceof i||arguments[0]instanceof e||arguments[0]instanceof n){var o=arguments[0];a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0)}else a.width=t,a.height=s;return a},createCocoonCanvas:function(t,e){var n=document.createElement("screencanvas");if(arguments[0]instanceof i){var s=arguments[0];n.width=s.width,n.height=s.height,n.getContext("2d").drawImage(s,0,0)}else n.width=t,n.height=e;return n},createImageData:function(t,e){return s.createCanvas(t,e).getContext("2d").createImageData(t,e)}}),s.Layer=function(t){this.context=t.getContext("2d"),this.canvas=t,this.prevAlignX=[],this.prevAlignY=[],this.alignX=0,this.alignY=0,this.aligned=!1,this.update()},s.Layer.prototype={constructor:s.Layer,update:function(){var e=s.smoothing;"undefined"!=typeof this.smoothing&&(e=this.smoothing),this.context.mozImageSmoothingEnabled=e,this.context.msImageSmoothingEnabled=e,this.context.webkitImageSmoothingEnabled=e,this.context.imageSmoothingEnabled=e,s.defaultFont&&(this.context.font=s.defaultFont),this.context.textBaseline=s.textBaseline,t&&Cocoon.Utils.setAntialias(e)},appendTo:function(t){if("object"==typeof t)var e=t;else var e=document.querySelector(t);return e.appendChild(this.canvas),this},a:function(t){return arguments.length?(this.previousAlpha=this.globalAlpha(),this.globalAlpha(t)):this.globalAlpha()},ra:function(){return this.a(this.previousAlpha)},realign:function(){return this.alignX=this.prevAlignX[this.prevAlignX.length-1],this.alignY=this.prevAlignY[this.prevAlignY.length-1],this},align:function(t,e){return"undefined"==typeof e&&(e=t),this.alignX=t,this.alignY=e,this},stars:function(t,e,i,n,s,a,o){return"undefined"==typeof i&&(i=.5),"undefined"==typeof n&&(n=.5),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=a),this.save(),this.translate(t,e),this.align(i,n),this.rotate(s),this.scale(a,o),this},tars:function(t,e,i,n,s,a,o){return"undefined"==typeof i&&(i=.5),"undefined"==typeof n&&(n=.5),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=1),"undefined"==typeof o&&(o=a),this.translate(t,e),this.align(i,n),this.rotate(s),this.scale(a,o),this},webkit:"WebkitAppearance"in document.documentElement.style,fillText:function(t,e,i,n){if(t=String(t),t.length){var a=!s.smoothing&&this.fontHeight()<=64&&"WebkitAppearance"in document.documentElement.style;if(a){var o=this.webkit?4:5,r=s.pool(),h=r.getContext("2d");h.font=this.context.font;var c=h.measureText(t).width,u=Math.ceil(c),n=n||u-c,l=this.fontHeight();r.width=u*o,r.height=l*o,s.setContextSmoothing(h,!1),h.font=this.context.font,h.fillStyle=this.context.fillStyle,h.textBaseline="top",h.scale(o,o),h.fillText(t,n,-this.fontTop()),"center"===this.context.textAlign?e-=.5*u:"right"===this.context.textAlign&&(e-=u),this.drawImage(r,0,0,r.width,r.height,e,i,r.width/o,r.height/o)}else this.context.fillText(t,e,i-this.fontTop());return this}},fillRect:function(){return this.alignX||this.alignY?this.context.fillRect(arguments[0]-arguments[2]*this.alignX|0,arguments[1]-arguments[3]*this.alignY|0,arguments[2],arguments[3]):this.context.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]),this},strokeRect:function(){return this.alignX||this.alignY?this.context.strokeRect(arguments[0]-arguments[2]*this.alignX|0,arguments[1]-arguments[3]*this.alignY|0,arguments[2],arguments[3]):this.context.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]),this},drawImage:function(t,e,i,n,s,a,o,r,h){return(this.alignX||this.alignY)&&(null==n?(e-=t.width*this.alignX|0,i-=t.height*this.alignY|0):(a-=r*this.alignX|0,o-=h*this.alignY|0)),null==n?this.context.drawImage(t,e,i):null==a?this.context.drawImage(t,e,i,n,s):this.context.drawImage(t,e,i,n,s,a,o,r,h),this},drawImageCentered:function(t,e,i,n,s,a,o,r,h){return null==n?(e-=.5*t.width|0,i-=.5*t.height|0):(a-=.5*r|0,o-=.5*h|0),null==n?this.context.drawImage(t,e,i):null==a?this.context.drawImage(t,e,i,n,s):this.context.drawImage(t,e,i,n,s,a,o,r,h),this},save:function(){return this.prevAlignX.push(this.alignX),this.prevAlignY.push(this.alignY),this.context.save(),this},restore:function(){return this.realign(),this.alignX=this.prevAlignX.pop(),this.alignY=this.prevAlignY.pop(),this.context.restore(),this},drawTile:function(t,e,i,n,s,a,o,r,h){},checkerboard:function(t,e,i,n,s,a,o){var r=i/s|0,h=n/s|0;this.save(),this.rect(t,e,i,n).clip();for(var c=0;r>=c;c++)for(var u=0;h>=u;u++){if(u%2)var l=c%2?a:o;else var l=c%2?o:a;this.fillStyle(l),this.fillRect(t+c*s,e+u*s,s,s)}this.restore()},drawAtlasFrame:function(t,e,i,n){var e=t.frames[e];return this.drawRegion(t.image,e.region,i-e.width*this.alignX+e.offset[0]+e.region[2]*this.alignX,n-e.height*this.alignY+e.offset[1]+e.region[3]*this.alignY),this},imageFill:function(t,e,i){var n=Math.max(e/t.width,i/t.height);this.save(),this.scale(n,n),this.drawImage(t,0,0),this.restore()},drawRegion:function(t,e,i,n,s){return s=s||1,this.drawImage(t,e[0],e[1],e[2],e[3],0|i,0|n,e[2]*s|0,e[3]*s|0)},drawRegionCentered:function(t,e,i,n,s){return s=s||1,this.drawImageCentered(t,e[0],e[1],e[2],e[3],0|i,0|n,e[2]*s|0,e[3]*s|0)},cache:function(){return this.clone().canvas},popup:function(){return window.open(this.canvas.toDataURL()),this},blendOn:function(t,e,i){return s.blend(t,this,e,i),this},posterize:function(t,e){t=t||32,e=e||4;for(var i=this.getImageData(0,0,this.width,this.height),n=i.data,s=0;s<n.length;s+=e)n[s]-=n[s]%t,n[s+1]-=n[s+1]%t,n[s+2]-=n[s+2]%t;return this.putImageData(i,0,0),this},posterizeAlpha:function(t,e){t=t||32,e=e||4;for(var i=this.getImageData(0,0,this.width,this.height),n=i.data,s=0;s<n.length;s+=e)n[s+3]-=n[s+3]%t;return this.putImageData(i,0,0),this},bw:function(t){t=128;for(var e=this.getImageData(0,0,this.width,this.height),i=e.data,n=0;n<i.length;n+=4){var s=(i[n]+i[n+1]+i[n+2])/3;s=128*(s/128|0),i[n+2]=s/255*i[n]}this.putImageData(e,0,0)},blend:function(t,e,i){if("string"==typeof t){var n=t;t=s(this.canvas.width,this.canvas.height),t.fillStyle(n).fillRect(0,0,this.canvas.width,this.canvas.height)}var a=s.blend(this,t,e,i);return this.canvas=a.canvas,this.context=a.context,this},textWithBackground:function(t,e,i,n,s){var a=this.measureText(t).width,o=.8*this.fontHeight(),r=this.fillStyle(),s=s||2;this.context.textAlign;return this.fillStyle(n).fillRect(e-2*s,i-s,a+4*s,o+2*s),this.fillStyle(r).textAlign("left").textBaseline("top").fillText(t,e,i),this},fillCircle:function(t,e,i){return this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.fill(),this},strokeCircle:function(t,e,i){return this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.stroke(),this},circle:function(t,e,i){return this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this},crop:function(t,e,i,n){if(1===arguments.length)var e=arguments[0][1],i=arguments[0][2],n=arguments[0][3],t=arguments[0][0];var a=s.createCanvas(i,n),o=a.getContext("2d");return o.drawImage(this.canvas,t,e,i,n,0,0,i,n),this.canvas.width=i,this.canvas.height=n,s.setContextSmoothing(this.context,!1),this.clear(),this.context.drawImage(a,0,0),this},set:function(t){s.extend(this.context,t)},resize:function(t,e){var i=t,n=e;1===arguments.length?(i=arguments[0]*this.canvas.width|0,n=arguments[0]*this.canvas.height|0):e===!1?this.canvas.width>t?(n=this.canvas.height*(t/this.canvas.width)|0,i=t):(i=this.canvas.width,n=this.canvas.height):t===!1&&(this.canvas.width>t?(i=this.canvas.width*(e/this.canvas.height)|0,n=e):(i=this.canvas.width,n=this.canvas.height));var a=s(i,n).drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,i,n);return this.canvas=a.canvas,this.context=a.context,this},resizeBounds:function(t,e){var i=s(t,e);return i.drawImage(this.canvas,0,0),this.canvas=i.canvas,this.context=i.context,this},imageLine:function(t,e,i,n,a,o,r){e||(e=[0,0,t.width,t.height]);var h=s.distance(i,n,a,o),c=h/e[3]+.5|0,u=Math.atan2(o-n,a-i)+Math.PI/2;this.save(),this.translate(i,n),this.rotate(u),r&&this.scale(r,1);for(var l=0;c>=l;l++)this.drawRegion(t,e,-e[2]/2|0,-e[3]*(l+1));return this.restore(),this},trim:function(t,e){var i;t?(t=s.color(t).toArray(),i=!t[3]):i=!0;for(var n=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),a=n.data,o=[this.canvas.width,this.canvas.height,0,0],r=this.canvas.width,h=this.canvas.height,c=0,u=a.length;u>c;c+=4){if(i){if(!a[c+3])continue}else if(a[c+0]===t[0]&&a[c+1]===t[1]&&a[c+2]===t[2])continue;var l=(c/4|0)%this.canvas.width|0,f=(c/4|0)/this.canvas.width|0;l<o[0]&&(o[0]=l),l>o[2]&&(o[2]=l),f<o[1]&&(o[1]=f),f>o[3]&&(o[3]=f)}return 0===o[2]&&0===o[3]||(e&&(e.left=o[0],e.top=o[1],e.bottom=h-o[3],e.right=r-o[2]-o[0],e.width=o[2]-o[0],e.height=o[3]-o[1]),this.crop(o[0],o[1],o[2]-o[0]+1,o[3]-o[1]+1)),this},matchPalette:function(t){if(t.matches||(t.matches=new Map),!t.colors){t.colors=[];for(var e=0;e<t.length;e++)t.colors.push(s.color(t[e]))}for(var i=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),n=i.data,e=0;e<n.length;e+=4){var a=[];if(n[e+3]){var o=(n[e+0]/s.matchPalettePrecision|0)*s.matchPalettePrecision+(n[e+1]/s.matchPalettePrecision|0)*s.matchPalettePrecision*1e3+(n[e+2]/s.matchPalettePrecision|0)*s.matchPalettePrecision*1e6;if(!t.matches.has(o)){for(var r=0;r<t.colors.length;r++){var h=t.colors[r],c=Math.abs(n[e]-h[0]),u=Math.abs(n[e+1]-h[1]),l=Math.abs(n[e+2]-h[2]);a.push(c+u+l);
}for(var f=0,r=0;r<t.length;r++)a[r]<a[f]&&(f=r);t.matches.set(o,t.colors[f])}var d=t.matches.get(o);n[e]=d[0],n[e+1]=d[1],n[e+2]=d[2]}}return this.context.putImageData(i,0,0),this},swapColors:function(t){var e={};for(var i in t){var n=s.color(i),a=n[0]+1e3*n[1]+1e6*n[2];e[a]=s.color(t[i])}for(var o=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),r=o.data,h=0;h<r.length;h+=4)if(r[h+3]){var a=r[h]+1e3*r[h+1]+1e6*r[h+2];e[a]&&(r[h]=e[a][0],r[h+1]=e[a][1],r[h+2]=e[a][2])}return this.context.putImageData(o,0,0),this},getPalette:function(){for(var t=[],e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,n=0,a=i.length;a>n;n+=4)if(i[n+3]){var o=s.rgbToHex(i[n+0],i[n+1],i[n+2]);-1===t.indexOf(o)&&t.push(o)}return t},mapPalette:function(){},polygon:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.beginPath(),this.moveTo(t[0][0]+e,t[0][1]+i);for(var n=1;n<t.length;n++)this.lineTo(t[n][0]+e,t[n][1]+i);return this.closePath(),this},fillPolygon:function(t){this.polygon(t),this.fill()},strokePolygon:function(t){this.polygon(t),this.stroke()},colorToMask:function(t,e){t=s.color(t).toArray();for(var i=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),n=i.data,a=[],o=0,r=n.length;r>o;o+=4)n[o+3]>0?a.push(!e):a.push(!!e);return a},grayscaleToMask:function(){for(var t=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),e=t.data,i=[],n=0,s=e.length;s>n;n+=4)i.push((e[n+0]+e[n+1]+e[n+2])/3/255);return i},applyMask:function(t){for(var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,n=("boolean"==typeof t[0]?"bool":"byte",0),s=i.length;s>n;n+=4){var a=t[n/4];i[n+3]=255*a|0}return this.context.putImageData(e,0,0),this},fillMask:function(t){var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,n="boolean"==typeof t[0]?"bool":"byte",a=2===arguments.length?"normal":"gradient",o=s.color(arguments[1]);"gradient"===a&&(colorB=s.color(arguments[2]));for(var r=0,h=i.length;h>r;r+=4){var c=t[r/4];"byte"===n&&(c/=255),"normal"===a?c&&(i[r+0]=0|o[0],i[r+1]=0|o[1],i[r+2]=0|o[2],i[r+3]=255*c|0):(i[r+0]=o[0]+(colorB[0]-o[0])*c|0,i[r+1]=o[1]+(colorB[1]-o[1])*c|0,i[r+2]=o[2]+(colorB[2]-o[2])*c|0,i[r+3]=255)}return this.context.putImageData(e,0,0),this},clear:function(t){return t?(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},clone:function(){var t=s.pool();return t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this.canvas,0,0),s(t)},gradientText:function(t,e,i,n,s){var a=t.split(" "),o=2*this.fontHeight(),r=0,h=0;if(n)for(var c=0,u=[""],l=0;l<a.length;l++){var f=a[l]+" ",d=this.context.measureText(f).width;r+d>n&&(u[++c]="",r=0),u[c]+=f,r+=d}else var u=[t];for(var l=0;l<u.length;l++){for(var h=i+l*o*.6|0,p=this.context.createLinearGradient(0,h,0,h+.6*o|0),g=0;g<s.length;g+=2)p.addColorStop(s[g],s[g+1]);var t=u[l];this.fillStyle(p).fillText(t,e,h)}return this},removeColor:function(t){t=s.color(t);for(var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,n=0;n<this.canvas.width;n++)for(var a=0;a<this.canvas.height;a++){var o=4*(a*this.canvas.width+n);i[o+0]===t[0]&&i[o+1]===t[1]&&i[o+2]===t[2]&&(i[o+3]=0)}return this.clear(),this.context.putImageData(e,0,0),this},outline:function(){function t(t,e){if(0>t)return 0;if(t>=a.width)return 0;if(0>e)return 0;if(e>=a.height)return 0;var n=4*(t+e*a.width);return i[n+3]>0}for(var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,n=this.createImageData(this.canvas.width,this.canvas.height),s=n.data,a=this.canvas,o=0;o<this.canvas.width;o++)for(var r=0;r<this.canvas.height;r++){var h=0,c=4*(r*a.width+o);i[c+3]&&(h+=t(o-1,r),h+=t(o+1,r),h+=t(o,r-1),h+=t(o,r+1),4!==h&&(s[c]=255,s[c+1]=255,s[c+2]=255,s[c+3]=255))}return this.context.putImageData(n,0,0),this},setHsl:function(){if(1===arguments.length)var t=arguments[0];else var t=arguments;for(var e,i,n,a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),o=a.data,r=[],h=[],c=0,u=o.length;u>c;c+=4)r=s.rgbToHsl(o[c+0],o[c+1],o[c+2]),e=t[0]===!1?r[0]:s.limitValue(t[0],0,1),i=t[1]===!1?r[1]:s.limitValue(t[1],0,1),n=t[2]===!1?r[2]:s.limitValue(t[2],0,1),h=s.hslToRgb(e,i,n),o[c+0]=h[0],o[c+1]=h[1],o[c+2]=h[2];return this.context.putImageData(a,0,0),this},shiftHsl:function(){if(1===arguments.length)var t=arguments[0];else var t=arguments;for(var e,i,n,a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),o=a.data,r=[],h=[],c=0,u=o.length;u>c;c+=4)r=s.rgbToHsl(o[c+0],o[c+1],o[c+2]),o[c+0]!==o[c+1]||o[c+1]!==o[c+2]?(e=t[0]===!1?r[0]:s.wrapValue(r[0]+t[0],0,1),i=t[1]===!1?r[1]:s.limitValue(r[1]+t[1],0,1)):(e=r[0],i=r[1]),n=t[2]===!1?r[2]:s.limitValue(r[2]+t[2],0,1),h=s.hslToRgb(e,i,n),o[c+0]=h[0],o[c+1]=h[1],o[c+2]=h[2];return this.context.putImageData(a,0,0),this},applyColor:function(e){return t?this:(this.save(),this.globalCompositeOperation("source-in"),this.clear(e),this.restore(),this)},negative:function(t,e){for(var i=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),n=i.data,s=0,a=n.length;a>s;s+=4)n[s+0]=255-n[s+0],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2];return this.context.putImageData(i,0,0),this},roundRect:function(t,e,i,n,s){return this.beginPath(),this.moveTo(t+s,e),this.lineTo(t+i-s,e),this.quadraticCurveTo(t+i,e,t+i,e+s),this.lineTo(t+i,e+n-s),this.quadraticCurveTo(t+i,e+n,t+i-s,e+n),this.lineTo(t+s,e+n),this.quadraticCurveTo(t,e+n,t,e+n-s),this.lineTo(t,e+s),this.quadraticCurveTo(t,e,t+s,e),this.closePath(),this},markupText:function(t){},charWidth:function(t){if(s.charWidthCache||(s.charWidthCache=new Map),!s.charWidthCache.has(this.context.font+t)){var e=this.measureText(t).width;s.charWidthCache.set(this.context.font+t,e)}return s.charWidthCache.get(this.context.font+t)},pixelText:function(t,e,i){var n=this.context.textAlign;this.context.textAlign="left";var s=0;if("center"===n){for(var a=0;a<t.length;a++){var o=this.charWidth(t[a]),r=o-(0|o);s+=o+(r>.5?1:0)|0}e-=s/2|0}for(var a=0;a<t.length;a++){var h=t[a],o=this.charWidth(h),r=o-(0|o);this.context.fillText(h,e,i),e+=o+(r>.5?1:0)|0}return this.context.textAlign=n,this},wrappedText:function(t,e,i,n,s){0>n&&(n=0);var a=t.split(" "),s=s||this.fontHeight(),o=0,r=0,h=this.context.textAlign,c=this.context.textBaseline;this.textBaseline("top");var u=0|this.context.measureText(" ").width;if(!n&&t.indexOf("\n")>-1&&(n=this.textBoundaries(t).width),n){for(var l=0,f=[""],d=[0],p=0;p<a.length;p++){var g=a[p],v=Math.ceil(this.context.measureText(g).width);if(n&&v>n){if(g.length<=5)return;var m=g.length/2|0;a.splice(p,1),a.splice(p,0,"-"+g.substr(m)),a.splice(p,0,g.substr(0,m)+"-"),p--}else(o+v>n||"\n"===a[p])&&(f[l]=f[l].substr(0,f[l].length-1),d[l]-=u,f[++l]="",d[l]=0,o=0),"\n"!==a[p]&&(f[l]+=g+" ",o+=v+u,d[l]+=v+u)}"\n"!==a[p]&&(f[l]=f[l].substr(0,f[l].length-1),d[l]-=u)}else var f=[t],d=[this.context.measureText(t).width];for(var p=0;p<f.length;p++){var r=i+p*s|0,t=f[p],w=d[p];this.textAlign("left"),"left"===h||"start"===h?this.fillText(t,e,r):"center"===h?this.fillText(t,e-.5*w|0,r):this.fillText(t,e-w,r)}return this.textAlign(h),this.textBaseline(c),this},fontHeights:{},fontTops:{},fontTop:function(){return this.fontTops[this.context.font]||this.fontHeight(),this.fontTops[this.context.font]},fontHeight:function(){var t=this.font();if(!this.fontHeights[t]){var e=parseInt(t),i=s(100,10+2*e|0);s.setContextSmoothing(i.context,!1),i.font(t).fillStyle("#fff"),i.textBaseline("top");var n=10;i.context.fillText("Play Moog",20,n);for(var a=i.getImageData(0,0,i.width,i.height).data,o=i.height,r=0,h=0;h<a.length;h+=4){var c=((h/4|0)%i.width,(h/4|0)/i.width|0);a[h+3]<200||(o>c&&(o=c),c>r&&(r=c))}this.fontHeights[t]=r-n+1,this.fontTops[t]=o-n}return this.fontHeights[t]},textBoundaries:function(t,e){0>e&&(e=0);for(var i=t.split(" "),n=this.fontHeight(),s=0,a=this.context.measureText(" ").width,o=0,r=[""],h=0,c=0;c<i.length;c++){var u=i[c],l=Math.ceil(this.context.measureText(u).width);if(e&&l>e){if(u.length<=5)continue;var f=u.length/2|0;i.splice(c,1),i.splice(c,0,"-"+u.substr(f)),i.splice(c,0,u.substr(0,f)+"-"),c--}else(s+l>e&&e||"\n"===i[c])&&(s>h&&(h=s),r[++o]="",s=0),"\n"!==i[c]&&(r[o]+=u,s+=l+a)}if(e)var h=e;else h||(h=this.context.measureText(t).width);return{height:r.length*n,width:Math.ceil(h),lines:r.length,fontHeight:n}},repeatImageRegion:function(t,e,i,n,s,a,o,r,h){this.save(),this.rect(a,o,r,h),this.clip();for(var c=0,u=Math.ceil(r/n);u>c;c++)for(var l=0,f=Math.ceil(h/s);f>l;l++)this.drawImage(t,e,i,n,s,a+c*n,o+l*s,n,s);return this.restore(),this},repeatImage:function(t,e,i,n,s){return arguments.length<9?this.repeatImageRegion(t,0,0,t.width,t.height,e,i,n,s):this.repeatImageRegion.apply(this,arguments),this},borderImageEmptyRegion:[0,0,0,0],borderImage:function(t,e,i,n,s,a,o,r,h,c){if("object"==typeof a){var u=a.region;if(u||(u=this.borderImageEmptyRegion,u[2]=t.width,u[3]=t.height),a.outset){var l=a.outset;n>2*l&&s>2*l&&(a.fill!==!1&&this.drawImage(t,u[0]+l,u[1]+l,u[2]-2*l,u[3]-2*l,e+l,i+l,n-2*l,s-2*l),this.drawImage(t,u[0],u[1]+l,l,u[3]-2*l,e,i+l,l,s-2*l),this.drawImage(t,u[0]+u[2]-l,u[1]+l,l,u[3]-2*l,e+n-l,i+l,l,s-2*l),this.drawImage(t,u[0]+l,u[1],u[2]-2*l,l,e+l,i,n-2*l,l),this.drawImage(t,u[0]+l,u[1]+u[3]-l,u[2]-2*l,l,e+l,i+s-l,n-2*l,l),this.drawImage(t,u[0],u[1],l,l,e,i,l,l),this.drawImage(t,u[0],u[1]+u[3]-l,l,l,e,i+s-l,l,l),this.drawImage(t,u[0]+u[2]-l,u[1],l,l,e+n-l,i,l,l),this.drawImage(t,u[0]+u[2]-l,u[1]+u[3]-l,l,l,e+n-l,i+s-l,l,l))}else{var f=a.bottomLeft||[0,0,0,0],d=a.bottomRight||[0,0,0,0],p=a.topLeft||[0,0,0,0],g=a.topRight||[0,0,0,0],v=f[3]+p[3],m=d[3]+g[3],w=p[2]+g[2],y=f[2]+d[2];a.fillPadding=[0,0,0,0],a.left&&(a.fillPadding[0]=a.left[2]),a.top&&(a.fillPadding[1]=a.top[3]),a.right&&(a.fillPadding[2]=a.right[2]),a.bottom&&(a.fillPadding[3]=a.bottom[3]),a.fill&&this.drawImage(t,a.fill[0],a.fill[1],a.fill[2],a.fill[3],e+a.fillPadding[0],i+a.fillPadding[1],n-a.fillPadding[2]-a.fillPadding[0],s-a.fillPadding[3]-a.fillPadding[1]),a.left&&this["stretch"===a.left[4]?"drawImage":"repeatImage"](t,a.left[0],a.left[1],a.left[2],a.left[3],e,i+p[3],a.left[2],s-v),a.right&&this["stretch"===a.right[4]?"drawImage":"repeatImage"](t,a.right[0],a.right[1],a.right[2],a.right[3],e+n-a.right[2],i+g[3],a.right[2],s-m),a.top&&this["stretch"===a.top[4]?"drawImage":"repeatImage"](t,a.top[0],a.top[1],a.top[2],a.top[3],e+p[2],i,n-w,a.top[3]),a.bottom&&this["stretch"===a.bottom[4]?"drawImage":"repeatImage"](t,a.bottom[0],a.bottom[1],a.bottom[2],a.bottom[3],e+f[2],i+s-a.bottom[3],n-y,a.bottom[3]),a.bottomLeft&&this.drawImage(t,a.bottomLeft[0],a.bottomLeft[1],a.bottomLeft[2],a.bottomLeft[3],e,i+s-a.bottomLeft[3],a.bottomLeft[2],a.bottomLeft[3]),a.topLeft&&this.drawImage(t,a.topLeft[0],a.topLeft[1],a.topLeft[2],a.topLeft[3],e,i,a.topLeft[2],a.topLeft[3]),a.topRight&&this.drawImage(t,a.topRight[0],a.topRight[1],a.topRight[2],a.topRight[3],e+n-a.topRight[2],i,a.topRight[2],a.topRight[3]),a.bottomRight&&this.drawImage(t,a.bottomRight[0],a.bottomRight[1],a.bottomRight[2],a.bottomRight[3],e+n-a.bottomRight[2],i+s-a.bottomRight[3],a.bottomRight[2],a.bottomRight[3])}}else a>0&&n-h-o>0&&this.drawImage(t,h,0,t.width-h-o,a,e+h,i,n-h-o,a),r>0&&n-h-o>0&&this.drawImage(t,h,t.height-r,t.width-h-o,r,e+h,i+s-r,n-h-o,r),h>0&&s-r-a>0&&this.drawImage(t,0,a,h,t.height-r-a,e,i+a,h,s-r-a),o>0&&s-r-a>0&&this.drawImage(t,t.width-o,a,o,t.height-r-a,e+n-o,i+a,o,s-r-a),h>0&&a>0&&this.drawImage(t,0,0,h,a,e,i,h,a),o>0&&a>0&&this.drawImage(t,t.width-o,0,o,a,e+n-o,i,o,a),o>0&&r>0&&this.drawImage(t,t.width-o,t.height-r,o,r,e+n-o,i+s-r,o,r),h>0&&r>0&&this.drawImage(t,0,t.height-r,h,r,e,i+s-r,h,r),c&&("string"==typeof c?this.fillStyle(c).fillRect(e+h,i+a,n-h-o,s-a-r):n-h-o>0&&s-a-r>0&&this.drawImage(t,h,a,t.width-o-h,t.height-r-a,e+h,i+a,n-h-o,s-a-r))},setPixel:function(t,e,i){return this.fillStyle(t).fillRect(e,i,1,1)},getPixel:function(t,e){var i=this.context.getImageData(t,e,1,1).data;return s.color([i[0],i[1],i[2],i[3]])},clearRect:function(t,e,i,n){return this.context.clearRect(t,e,i,n),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},createImageData:function(t,e){return this.emptyCanvas||(this.emptyCanvas=s.createCanvas(t,e),this.emptyCanvasContext=this.emptyCanvas.getContext("2d")),this.emptyCanvas.width=t,this.emptyCanvas.height=e,this.emptyCanvasContext.getImageData(0,0,t,e)},strokeLine:function(t,e,i,n){return this.beginPath(),"undefined"==typeof i?(this.moveTo(t.x,t.y),this.lineTo(e.x,e.y)):(this.moveTo(t,e),this.lineTo(i,n)),this.stroke(),this},shadowOffset:function(t,e){return this.context.shadowOffsetX=t,this.context.shadowOffsetY=e,this},noLineDash:[],tempLineDash:[2,2],setLineDash:function(t){return"number"==typeof t&&(this.tempLineDash[0]=t,this.tempLineDash[1]=t,t=this.tempLineDash),this.context.setLineDash(t?t:this.noLineDash),this},measureText:function(t){return this.context.measureText(t)},getLineDash:function(){return this.context.getLineDash()},createRadialGradient:function(t,e,i,n,s,a){return this.context.createRadialGradient(t,e,i,n,s,a)},createLinearGradient:function(t,e,i,n){return this.context.createLinearGradient(t,e,i,n)},createPattern:function(t,e){return this.context.createPattern(t,e)},getImageData:function(t,e,i,n){return this.context.getImageData(t,e,i,n)},writeMeta:function(t){var e=JSON.stringify(t);e=encodeURIComponent(e);for(var i=[],n=0;n<e.length;n++)i.push(e.charCodeAt(n));i.push(127);for(var a=this.width-1,o=this.height-1,r=[];i.length;){var h=i.shift();if(r.unshift(2*h),!i.length)for(var n=0;n<3-r.length;n++)r.unshift(254);3===r.length&&(this.fillStyle(s.color(r).toRgb()).fillRect(a,o,1,1),r=[],a--,0>a&&(o--,a=this.width-1))}return this},strokeStyle:function(t){return null==t?this.context.strokeStyle:(this.context.strokeStyle=t,this)},fillStyle:function(t){return null==t?this.context.fillStyle:(this.context.fillStyle=t,this)},font:function(t){return null==t?this.context.font:(this.context.font=t,this)},filter:function(t){return t?(this.context.filter=t,this):this.context.filter},readMeta:function(){for(var t=[],e=this.width-1,i=this.height-1;;){for(var n=this.getPixel(e,i),s=!1,a=0;3>a;a++)254===n[2-a]?s=!0:t.push(n[2-a]/2|0);if(s)break;if(e--,0>e){i--,e=this.width-1;break}}for(var o="";t.length;)o+=String.fromCharCode(t.shift());var r=!1;console.log(o);try{r=JSON.parse(decodeURIComponent(o))}catch(h){}return r},get width(){return this.canvas.width},get height(){return this.canvas.height},set width(t){return this.canvas.width=t,this.update(),this.canvas.width},set height(t){return this.canvas.height=t,this.update(),this.canvas.height}};for(var a=["arc","arcTo","beginPath","bezierCurveTo","clip","closePath","createLinearGradient","createRadialGradient","createPattern","drawFocusRing","drawImage","fill","fillRect","fillText","getImageData","isPointInPath","lineTo","measureText","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","scale","setTransform","strokeRect","strokeText","transform","translate","setLineDash"],o=0;o<a.length;o++){var r=a[o];if(!s.Layer.prototype[r]){s.Layer.prototype[r]=function(t){return function(){for(var e=new Array(arguments.length),i=0;i<e.length;++i)e[i]=arguments[i];return s.fastApply(t,this.context,e),this}}(CanvasRenderingContext2D.prototype[r])}}for(var h=["globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","textAlign","textBaseline","lineDashOffset"],o=0;o<h.length;o++){var r=h[o];s.Layer.prototype[r]||(s.Layer.prototype[r]=Function("if(arguments.length) { this.context."+r+" = arguments[0]; return this; } else { return this.context."+r+"; }"))}return s.Color=function(t,e){arguments.length&&this.parse(t,e)},s.Color.prototype={toString:function(){return this.toRgb()},parse:function(t,e){if(t[0]instanceof s.Color)return this[0]=t[0][0],this[1]=t[0][1],this[2]=t[0][2],void(this[3]=t[0][3]);if("string"==typeof t){var i=null;if("#"===t[0]){var n=s.hexToRgb(t);this[0]=n[0],this[1]=n[1],this[2]=n[2],this[3]=1}else(i=t.match(/rgb\((.*),(.*),(.*)\)/))?(this[0]=0|i[1],this[1]=0|i[2],this[2]=0|i[3],this[3]=1):(i=t.match(/rgba\((.*),(.*),(.*)\)/))?(this[0]=0|i[1],this[1]=0|i[2],this[2]=0|i[3],this[3]=0|i[4]):(i=t.match(/hsl\((.*),(.*),(.*)\)/))?this.fromHsl(i[1],i[2],i[3]):(i=t.match(/hsv\((.*),(.*),(.*)\)/))&&this.fromHsv(i[1],i[2],i[3])}else switch(e){case"hsl":case"hsla":this.fromHsl(t[0],t[1],t[2],t[3]);break;case"hsv":case"hsva":this.fromHsv(t[0],t[1],t[2],t[3]);break;default:this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]="undefined"==typeof t[3]?1:t[3]}},a:function(t){return 1!==arguments.length?this[3]:(this[3]=t,this)},alpha:function(t){return 1!==arguments.length?this[3]:(this[3]=t,this)},fromHsl:function(){var t=arguments[0]instanceof Array?arguments[0]:arguments,e=s.hslToRgb(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]="undefined"==typeof arguments[3]?1:arguments[3]},fromHsv:function(){var t=arguments[0]instanceof Array?arguments[0]:arguments,e=s.hsvToRgb(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]="undefined"==typeof arguments[3]?1:arguments[3]},toArray:function(){return[this[0],this[1],this[2],this[3]]},toRgb:function(){return"rgb("+this[0]+", "+this[1]+", "+this[2]+")"},toRgba:function(){return"rgba("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"},toHex:function(){return s.rgbToHex(this[0],this[1],this[2])},toHsl:function(){var t=s.rgbToHsl(this[0],this[1],this[2]);return t[3]=this[3],t},toHsv:function(){var t=s.rgbToHsv(this[0],this[1],this[2]);return t[3]=this[3],t},gradient:function(t,e){s.color(t)},shiftHsl:function(){var t=this.toHsl();if(this[0]!==this[1]||this[1]!==this[2])var e=arguments[0]===!1?t[0]:s.wrapValue(t[0]+arguments[0],0,1),i=arguments[1]===!1?t[1]:s.limitValue(t[1]+arguments[1],0,1);else var e=t[0],i=t[1];var n=arguments[2]===!1?t[2]:s.limitValue(t[2]+arguments[2],0,1);return this.fromHsl(e,i,n),this},setHsl:function(){var t=this.toHsl(),e=arguments[0]===!1?t[0]:s.limitValue(arguments[0],0,1),i=arguments[1]===!1?t[1]:s.limitValue(arguments[1],0,1),n=arguments[2]===!1?t[2]:s.limitValue(arguments[2],0,1);return this.fromHsl(e,i,n),this},mix:function(t,e){t=s.color(t);for(var i=0;4>i;i++)this[i]=s.mix(this[i],t[i],e);return this}},window.cq=window.CanvasQuery=s,s}(),PLAYGROUND.Renderer=function(t){this.app=t,t.on("create",this.create.bind(this)),t.on("resize",this.resize.bind(this)),t.on("kill",this.kill.bind(this))},PLAYGROUND.Renderer.plugin=!0,PLAYGROUND.Renderer.prototype={kill:function(){this.app.layer.canvas.parentNode.removeChild(this.app.layer.canvas)},create:function(t){this.app.layer=cq().appendTo(this.app.container),this.app.customContainer||(this.app.container.style.margin="0px",this.app.container.style.overflow="hidden")},resize:function(t){var e=this.app,i=e.layer;i.width=e.width,i.height=e.height,document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(i.canvas.style.transformOrigin="center",i.canvas.style.webkitTransformOrigin="center"):(i.canvas.style.transformOrigin="0 0",i.canvas.style.webkitTransformOrigin="0 0"),i.canvas.style.transform="translate("+e.offsetX+"px,"+e.offsetY+"px) scale("+e.scale+", "+e.scale+")",i.canvas.style.transformStyle="preserve-3d",i.canvas.style.webkitTransform="translate("+e.offsetX+"px,"+e.offsetY+"px) scale("+e.scale+", "+e.scale+")",i.canvas.style.webkitTransformStyle="preserve-3d",cq.smoothing=this.app.smoothing,i.update(),"WebkitAppearance"in document.documentElement.style?i.canvas.style.imageRendering=this.app.smoothing?"auto":"pixelated":i.canvas.style.imageRendering=this.app.smoothing?"auto":"-moz-crisp-edges",i.canvas.addEventListener("mousedown",function(){this.focus()})}},PLAYGROUND.Transitions=function(t){this.app=t,t.on("enterstate",this.enterstate.bind(this)),t.on("afterpostrender",this.postrender.bind(this)),t.on("step",this.step.bind(this)),this.progress=1,this.lifetime=0,t.transition=t.transition?t.transition:"split",t.transitionDuration=t.transitionDuration?t.transitionDuration:.5},PLAYGROUND.Transitions.plugin=!0,PLAYGROUND.Transitions.prototype={enterstate:function(t){this.app.screenshot=this.screenshot=this.app.layer.cache(),t.prev&&(this.lifetime=0,this.progress=0)},postrender:function(){if(!(this.progress>=1)){var t=PLAYGROUND.Transitions[this.app.transition];t(this.app,this.progress,this.screenshot)}},step:function(t){this.progress>=1||(this.lifetime+=t,this.progress=Math.min(this.lifetime/this.app.transitionDuration,1))}},PLAYGROUND.Transitions.implode=function(t,e,i){e=t.ease(e,"outCubic");var n=1-e;t.layer.save(),t.layer.tars(t.center.x,t.center.y,.5,.5,0,.5+.5*n,n),t.layer.drawImage(i,0,0),t.layer.restore()},PLAYGROUND.Transitions.split=function(t,e,i){e=t.ease(e,"inOutCubic");var n=1-e;t.layer.save(),t.layer.a(n).clear("#fff").ra(),t.layer.drawImage(i,0,0,t.width,t.height/2|0,0,0,t.width,n*t.height/2|0),t.layer.drawImage(i,0,t.height/2|0,t.width,t.height/2|0,0,t.height/2+e*t.height/2+1|0,t.width,Math.max(1,n*t.height*.5|0)),t.layer.restore()},PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var t=this;this.logo=new Image,this.logo.addEventListener("load",function(){t.ready=!0}),this.logo.src=this.logoRaw,window.getComputedStyle},enter:function(){this.current=0},leave:function(){this.locked=!0,this.animation=this.app.tween(this).to({current:1},.5)},step:function(t){this.locked?this.animation.finished&&(this.locked=!1):this.current=this.current+Math.abs(this.app.loader.progress-this.current)*t},ready:function(){},render:function(){if(this.ready){this.app.layer.clear(this.app.background),this.app.layer.fillStyle("#fff"),this.app.layer.save(),this.app.layer.align(.5,.5),this.app.layer.globalCompositeOperation("lighter"),this.app.layer.drawImage(this.logo,this.app.center.x,this.app.center.y);var t=this.current*this.logo.width;this.app.layer.fillStyle("#fff"),this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,t,12),this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,this.logo.width,4),this.app.layer.restore()}}};
function setScale(){scale=innerWidth>innerHeight/slideRatio?innerHeight/slideRatio/slideWidth:innerWidth*slideRatio/slideHeight,scale=Math.max(Math.min(scale,scaleMax),scaleMin)+.001,scaleOutline=1/scale*5,slide.style.transform="scale("+scale+")",slide.style.outlineWidth=scaleOutline+"px"}function onResize(e){setScale()}function loadSlide(e){location.hash=e+1,window.dispatchEvent(slideChangeEvent),document.documentElement.classList.add("loading");var t=new XMLHttpRequest;t.open("GET","slides/"+slides[e]+"/index.html",!0),t.onload=function(){t.status>=200&&t.status<400&&(clearTimeout(slideTimeout),slideTimeout=setTimeout(function(){if(document.documentElement.classList.remove("loading"),null!==lastSlide){var i=document.querySelector(".stylesheet-"+lastSlide);i.parentNode.removeChild(i);var s=document.querySelector(".script-"+lastSlide);s.parentNode.removeChild(s)}var d=document.createElement("link");d.rel="stylesheet",d.href="slides/"+slides[e]+"/index.css",d.classList.add("stylesheet-"+e),document.getElementsByTagName("head")[0].appendChild(d),slideContent.innerHTML=t.responseText;var n=document.createElement("script");n.setAttribute("src","slides/"+slides[e]+"/index.js"),n.classList.add("script-"+e),document.getElementsByTagName("head")[0].appendChild(n)},20))},t.onerror=function(){},t.send()}function prevSlide(){currentSlide>0&&(document.documentElement.classList.add("prev"),document.documentElement.classList.remove("next"),lastSlide=currentSlide,currentSlide--,loadSlide(currentSlide))}function nextSlide(){totalSlides-1>currentSlide&&(document.documentElement.classList.add("next"),document.documentElement.classList.remove("prev"),lastSlide=currentSlide,currentSlide++,loadSlide(currentSlide))}var slide=document.querySelector(".slide"),slideContent=document.querySelector(".slide-content"),slideBcr=slide.getBoundingClientRect(),slideWidth=slideBcr.width,slideHeight=slideBcr.height,slideRatio=slideHeight/slideWidth,scaleMin=0,scaleMax=1/0,scale,scaleOutline,keyMap={up:["up","w"],right:["right","d"],down:["down","s"],left:["left","a"],prev:["openbracket","l1"],next:["closebraket","r1"]},keys={up:0,right:0,down:0,left:0},dirs={up:document.querySelector(".dir-up"),right:document.querySelector(".dir-right"),down:document.querySelector(".dir-down"),left:document.querySelector(".dir-left")};addEventListener("resize",onResize),setScale();var slides=["title","demo","demo-2"],slideChangeEvent=new Event("slideChange"),slideTimeout=null,currentSlide=location.hash?location.hash.slice(1)-1:0,lastSlide=null,totalSlides=slides.length,prevSlideButton=document.querySelector(".nav-prev"),nextSlideButton=document.querySelector(".nav-next");currentSlide>totalSlides&&(currentSlide=0),prevSlideButton.addEventListener("click",function(e){e.preventDefault(),prevSlide()}),nextSlideButton.addEventListener("click",function(e){e.preventDefault(),nextSlide()}),loadSlide(currentSlide);var overview=playground({keydown:function(e){keyMap.up.indexOf(e.key)>-1?(keys.up=1,dirs.up.classList.add("is-active")):keyMap.right.indexOf(e.key)>-1?(keys.right=1,dirs.right.classList.add("is-active")):keyMap.down.indexOf(e.key)>-1?(keys.down=1,dirs.down.classList.add("is-active")):keyMap.left.indexOf(e.key)>-1?(keys.left=1,dirs.left.classList.add("is-active")):keyMap.prev.indexOf(e.key)>-1?prevSlide():keyMap.next.indexOf(e.key)>-1&&nextSlide()},keyup:function(e){keyMap.up.indexOf(e.key)>-1?(keys.up=0,dirs.up.classList.remove("is-active")):keyMap.right.indexOf(e.key)>-1?(keys.right=0,dirs.right.classList.remove("is-active")):keyMap.down.indexOf(e.key)>-1?(keys.down=0,dirs.down.classList.remove("is-active")):keyMap.left.indexOf(e.key)>-1&&(keys.left=0,dirs.left.classList.remove("is-active"))},gamepaddown:function(e){keyMap.up.indexOf(e.button)>-1?(keys.up=1,dirs.up.classList.add("is-active")):keyMap.right.indexOf(e.button)>-1?(keys.right=1,dirs.right.classList.add("is-active")):keyMap.down.indexOf(e.button)>-1?(keys.down=1,dirs.down.classList.add("is-active")):keyMap.left.indexOf(e.button)>-1?(keys.left=1,dirs.left.classList.add("is-active")):keyMap.prev.indexOf(e.button)>-1?prevSlide():keyMap.next.indexOf(e.button)>-1&&nextSlide()},gamepadup:function(e){keyMap.up.indexOf(e.button)>-1?(keys.up=0,dirs.up.classList.remove("is-active")):keyMap.right.indexOf(e.button)>-1?(keys.right=0,dirs.right.classList.remove("is-active")):keyMap.down.indexOf(e.button)>-1?(keys.down=0,dirs.down.classList.remove("is-active")):keyMap.left.indexOf(e.button)>-1&&(keys.left=0,dirs.left.classList.remove("is-active"))}});